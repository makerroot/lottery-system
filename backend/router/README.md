# Router æ¨¡å—

æŠ½å¥–ç³»ç»Ÿåç«¯è·¯ç”±é…ç½®æ¨¡å—ã€‚

## ğŸ“ æ–‡ä»¶ç»“æ„

```
router/
â”œâ”€â”€ router.go      # è·¯ç”±é…ç½®
â”œâ”€â”€ ROUTES.md      # API è·¯ç”±æ–‡æ¡£
â””â”€â”€ README.md      # æœ¬æ–‡ä»¶
```

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### æ¨¡å—åŒ–è·¯ç”±ç®¡ç†

å°†è·¯ç”±ä» `main.go` ä¸­æå–å‡ºæ¥ï¼Œå®ç°ä»¥ä¸‹æ”¹è¿›ï¼š

1. **ä»£ç ç»„ç»‡** - è·¯ç”±é…ç½®ç‹¬ç«‹ç®¡ç†
2. **å¯ç»´æŠ¤æ€§** - è·¯ç”±å®šä¹‰æ¸…æ™°åˆ†ç»„
3. **å¯æµ‹è¯•æ€§** - ä¾¿äºå•å…ƒæµ‹è¯•
4. **å¯æ‰©å±•æ€§** - æ˜“äºæ·»åŠ æ–°è·¯ç”±

### è·¯ç”±åˆ†ç»„

- **å¥åº·æ£€æŸ¥**: `/api/health`
- **ç”¨æˆ·ç«¯ API**: `/api/*`
- **ç®¡ç†åå°**: `/admin/*`

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

åœ¨ `main.go` ä¸­ï¼š

```go
import (
    "lottery-system/router"
)

func main() {
    // ... åˆå§‹åŒ–é…ç½®ã€æ•°æ®åº“ç­‰

    // è®¾ç½®è·¯ç”±
    r := router.SetupRouter()

    // å¯åŠ¨æœåŠ¡å™¨
    r.Run(":8080")
}
```

### ä¸­é—´ä»¶é…ç½®

è·¯ç”±æ¨¡å—ä¼šè‡ªåŠ¨åº”ç”¨ä»¥ä¸‹ä¸­é—´ä»¶ï¼š

1. **CORS ä¸­é—´ä»¶** - è·¨åŸŸè¯·æ±‚å¤„ç†
2. **é™æµä¸­é—´ä»¶** - è‡ªåŠ¨é€‰æ‹© Redis æˆ–å†…å­˜é™æµ
3. **è®¤è¯ä¸­é—´ä»¶** - åœ¨å„ä¸ªè·¯ç”±ç»„ä¸­æŒ‰éœ€åº”ç”¨

### æ·»åŠ æ–°è·¯ç”±

#### æ·»åŠ ç”¨æˆ·ç«¯ API

åœ¨ `setupUserAPIRoutes` å‡½æ•°ä¸­æ·»åŠ ï¼š

```go
func setupUserAPIRoutes(r *gin.Engine) {
    api := r.Group("/api")
    {
        // ... ç°æœ‰è·¯ç”±

        userAuth := api.Group("")
        userAuth.Use(middleware.UserAuthMiddleware())
        {
            // æ·»åŠ æ–°çš„éœ€è¦è®¤è¯çš„è·¯ç”±
            userAuth.GET("/new-endpoint", handlers.NewHandler)
        }
    }
}
```

#### æ·»åŠ ç®¡ç†åå° API

åœ¨ `setupAdminAPIRoutes` å‡½æ•°ä¸­æ·»åŠ ï¼š

```go
func setupAdminAPIRoutes(r *gin.Engine) {
    admin := r.Group("/admin")
    {
        // ... ç°æœ‰è·¯ç”±

        auth := admin.Group("")
        auth.Use(middleware.AuthMiddleware())
        {
            // æ·»åŠ æ–°çš„éœ€è¦è®¤è¯çš„è·¯ç”±
            auth.GET("/new-endpoint", handlers.NewAdminHandler)
        }
    }
}
```

## ğŸ“Š ä»£ç ç»Ÿè®¡

### é‡æ„å‰åå¯¹æ¯”

| æŒ‡æ ‡ | é‡æ„å‰ | é‡æ„å | æ”¹è¿› |
|------|--------|--------|------|
| main.go è¡Œæ•° | 162 | 62 | **-62%** |
| è·¯ç”±å®šä¹‰ | æ··åˆåœ¨ main.go | ç‹¬ç«‹æ¨¡å— | **æ¨¡å—åŒ–** |
| å¯ç»´æŠ¤æ€§ | ä½ | é«˜ | **âœ…** |
| å¯æµ‹è¯•æ€§ | å›°éš¾ | å®¹æ˜“ | **âœ…** |

### å‡½æ•°åˆ—è¡¨

- `SetupRouter()` - ä¸»è·¯ç”±é…ç½®å‡½æ•°
- `setupHealthCheckRoutes()` - å¥åº·æ£€æŸ¥è·¯ç”±
- `setupUserAPIRoutes()` - ç”¨æˆ·ç«¯ API è·¯ç”±
- `setupAdminAPIRoutes()` - ç®¡ç†åå° API è·¯ç”±

## ğŸ”§ é…ç½®è¯´æ˜

### Redis é™æµæ£€æµ‹

è·¯ç”±æ¨¡å—ä½¿ç”¨ `middleware.IsRedisEnabled()` æ¥åˆ¤æ–­æ˜¯å¦ä½¿ç”¨ Redis é™æµï¼š

```go
if middleware.IsRedisEnabled() {
    r.Use(middleware.RedisRateLimitMiddleware())
} else {
    r.Use(middleware.RateLimitMiddleware())
}
```

### ä¸­é—´ä»¶åº”ç”¨é¡ºåº

1. å…¨å±€ä¸­é—´ä»¶ï¼ˆåœ¨ `SetupRouter` ä¸­ï¼‰:
   - CORS ä¸­é—´ä»¶
   - é™æµä¸­é—´ä»¶

2. è·¯ç”±ç»„ä¸­é—´ä»¶ï¼ˆåœ¨å„è·¯ç”±ç»„ä¸­ï¼‰:
   - ç”¨æˆ·è®¤è¯ä¸­é—´ä»¶
   - ç®¡ç†å‘˜è®¤è¯ä¸­é—´ä»¶

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **API è·¯ç”±æ–‡æ¡£**: [ROUTES.md](./ROUTES.md)
- **é¡¹ç›®æ¶æ„**: `../ARCHITECTURE.md`
- **API æ–‡æ¡£**: `../API.md`

## ğŸ¯ æœ€ä½³å®è·µ

### 1. è·¯ç”±å‘½å

- ä½¿ç”¨ RESTful é£æ ¼
- åè¯å¤æ•°å½¢å¼: `/users`, `/admins`
- å±‚çº§æ¸…æ™°: `/admin/companies/:id`

### 2. è®¤è¯åˆ†ç»„

- å…¬å¼€æ¥å£: æ— è®¤è¯ä¸­é—´ä»¶
- ç”¨æˆ·æ¥å£: `UserAuthMiddleware()`
- ç®¡ç†æ¥å£: `AuthMiddleware()`

### 3. ç‰ˆæœ¬æ§åˆ¶

å¦‚æœ‰éœ€è¦ï¼Œå¯ä»¥æ·»åŠ ç‰ˆæœ¬å‰ç¼€ï¼š

```go
v1 := r.Group("/api/v1")
{
    v1.GET("/users", handlers.GetUsers)
}
```

## ğŸ”„ è¿ç§»æŒ‡å—

### ä»æ—§ä»£ç è¿ç§»

å¦‚æœä½ éœ€è¦åœ¨æ—§ç‰ˆæœ¬ä¸­æ·»åŠ è·¯ç”±ï¼š

**æ—§æ–¹å¼** (åœ¨ main.go ä¸­):
```go
r := gin.Default()
r.GET("/api/users", handlers.GetUsers)
```

**æ–°æ–¹å¼** (ä½¿ç”¨è·¯ç”±æ¨¡å—):
```go
r := router.SetupRouter()
// è·¯ç”±å·²åœ¨ router.go ä¸­å®šä¹‰
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä¸­é—´ä»¶é¡ºåº**: ç¡®ä¿ä¸­é—´ä»¶åº”ç”¨é¡ºåºæ­£ç¡®
2. **è·¯ç”±å†²çª**: é¿å…å®šä¹‰ç›¸åŒçš„è·¯ç”±è·¯å¾„
3. **è®¤è¯æ£€æŸ¥**: æ•æ„Ÿæ¥å£åŠ¡å¿…æ·»åŠ è®¤è¯ä¸­é—´ä»¶
4. **é”™è¯¯å¤„ç†**: åœ¨ handlers ä¸­ç»Ÿä¸€å¤„ç†é”™è¯¯

## ğŸ“ ç»´æŠ¤æ—¥å¿—

### 2026-01-25
- âœ… ä» main.go æå–è·¯ç”±é…ç½®
- âœ… åˆ›å»ºç‹¬ç«‹è·¯ç”±æ¨¡å—
- âœ… æ·»åŠ è·¯ç”±æ–‡æ¡£
- âœ… main.go å‡å°‘ 100 è¡Œä»£ç 

---

**ç»´æŠ¤è€…**: Lottery System Team
**æœ€åæ›´æ–°**: 2026-01-25
