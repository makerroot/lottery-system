import{j as x,r as n,w as fs,o as gs,f as ys,U,V as u,_ as d,u as q,Z as s,c,X as m,F as H,a4 as i,G as I,W as Oe,a0 as h,$ as _s,a1 as le,a3 as pe,a2 as ze,a5 as Qe}from"./vue-vendor-6562d100.js";import{aT as ws,aS as bs}from"./vendor-a94b8c86.js";import{a as F,p as hs}from"./api-b09b12eb.js";import{r as ks}from"./request-5e349af4.js";import{_ as xs}from"./_plugin-vue_export-helper-c27b6911.js";import{a2 as Cs,a3 as Ps}from"./antd-icons-bbb5d9cb.js";import{m as p}from"./antd-vue-e1953b5a.js";import"./axios-78d57de0.js";import"./dayjs-793f537c.js";const R=n(null),Te=n(null),De=n(!1),L={id:1,code:"DEFAULT",name:"é»˜è®¤å…¬å¸",logo:"",theme_color:"#00fff5",bg_color:"#0a0f14",title:"ğŸ‰ å¹¸è¿å¤§æŠ½å¥–",subtitle:"Luck Lottery System",welcome_text:"æ¬¢è¿å‚ä¸æŠ½å¥–æ´»åŠ¨ï¼",rules_text:"æ¯äººåªèƒ½æŠ½ä¸€æ¬¡ï¼Œç¥æ‚¨å¥½è¿ï¼",draw_button_text:"ç‚¹å‡»æŠ½å¥–",success_text:"æ­å–œæ‚¨è·å¾—",contact_name:"ç®¡ç†å‘˜",contact_phone:"400-888-8888",contact_email:"admin@example.com"};async function Je(k){if(!k){let l=null;if(window.location.hash.includes("?")){const z=window.location.hash.split("?");z.length>1&&(l=new URLSearchParams(z[1]).get("company"))}!l&&window.location.search&&(l=new URLSearchParams(window.location.search).get("company")),k=l||"DEFAULT"}Te.value=k,De.value=!0;try{const l=await F.get("/api/company",{params:{code:k}});return R.value=l,l}catch{return R.value=L,L}finally{De.value=!1}}function Ss(){const k=l=>{Te.value=l};return{companyConfig:x(()=>R.value||L),companyCode:x(()=>Te.value||"DEFAULT"),setCompanyCode:k,isLoading:x(()=>De.value),themeColor:x(()=>{var l;return((l=R.value)==null?void 0:l.theme_color)||L.theme_color}),bgColor:x(()=>{var l;return((l=R.value)==null?void 0:l.bg_color)||L.bg_color}),title:x(()=>{var l;return((l=R.value)==null?void 0:l.title)||L.title}),subtitle:x(()=>{var l;return((l=R.value)==null?void 0:l.subtitle)||L.subtitle}),welcomeText:x(()=>{var l;return((l=R.value)==null?void 0:l.welcome_text)||L.welcome_text}),rulesText:x(()=>{var l;return((l=R.value)==null?void 0:l.rules_text)||L.rules_text}),drawButtonText:x(()=>{var l;return((l=R.value)==null?void 0:l.draw_button_text)||L.draw_button_text}),successText:x(()=>{var l;return((l=R.value)==null?void 0:l.success_text)||L.successText})}}function Is(){const k=n(localStorage.getItem("lottery_user")),l=n(!!k.value),z=n({}),N=()=>{if(!k.value){z.value={};return}try{z.value=JSON.parse(k.value)}catch{z.value={}}},V=()=>{k.value=localStorage.getItem("lottery_user"),l.value=!!k.value,N()};V();const me=g=>{if(g.token){localStorage.setItem("lottery_token",g.token);const M=g.user||g;localStorage.setItem("lottery_user",JSON.stringify(M))}else localStorage.setItem("lottery_user",JSON.stringify(g));V()},fe=()=>{localStorage.removeItem("lottery_user"),localStorage.removeItem("lottery_token"),V()};return window.addEventListener("storage",g=>{(g.key==="lottery_user"||g.key===null)&&V()}),{userLoggedIn:l,currentUser:z,setUser:me,clearUser:fe,checkLoginStatus:V}}const Ls={key:0,class:"user-login-overlay"},Us={class:"login-container glass"},Rs=["disabled"],zs={key:0,class:"button-spinner"},$s={class:"neon-background"},Ts={class:"top-status-bar glass"},Ds={class:"status-bar-content"},As={class:"status-item"},qs={class:"status-icon"},Ms={class:"status-label font-body"},Es={class:"status-item"},Fs={class:"status-value font-display"},Ns={class:"status-item"},Vs={class:"status-value font-display"},Ws={style:{"text-align":"center",padding:"20px 0"}},Bs={key:0,style:{padding:"40px 0"}},Os={key:1},Qs=["src"],Js={class:"top-status-bar glass"},Ks={class:"status-bar-content"},js={class:"status-item"},Gs={class:"status-value font-display"},Hs={class:"status-item"},Xs={class:"status-value font-display"},Zs={class:"lottery-content"},Ys={class:"stage-area"},et={class:"lottery-display"},st={class:"display-container glass neon-border-flow mega-display"},tt={key:0,class:"drawing-animation"},ot=["data-index"],at={class:"user-name font-display"},lt={class:"user-phone font-mono"},nt={key:1,class:"highlight-frame"},rt={key:2,class:"waiting-overlay"},it={key:3,class:"drawing-overlay"},ut={key:1,class:"result-showcase"},ct={class:"result-title font-display"},dt={class:"winners-list"},vt={class:"winner-avatar font-display"},pt={class:"winner-info"},mt={class:"winner-name font-display"},ft={class:"winner-phone font-mono"},gt={class:"winner-prize"},yt={class:"prize-level"},_t={class:"prize-name"},wt={key:0,class:"controls-area"},bt={class:"config-card glass control-panel"},ht={class:"config-form"},kt={class:"refresh-section"},xt={class:"qr-section"},Ct={class:"form-group"},Pt={class:"level-option"},St={class:"level-main"},It={class:"level-name font-display"},Lt={class:"level-stock"},Ut={class:"stock-text"},Rt={key:0,class:"form-error"},zt={class:"form-group"},$t={class:"count-selector"},Tt={class:"quick-counts"},Dt=["onClick","disabled"],At={class:"form-tip font-body"},qt={class:"draw-actions"},Mt=["disabled"],Et={key:0,class:"button-spinner"},Ft={key:1,class:"controls-area"},Nt={class:"config-card glass control-panel user-info-panel"},Vt={class:"user-info-content"},Wt={class:"info-item"},Bt={class:"info-details"},Ot={class:"info-value font-display"},Qt={class:"info-item"},Jt={class:"info-details"},Kt={class:"info-value font-display"},jt={class:"info-item"},Gt={class:"info-details"},Ht={class:"info-value font-display"},Xt={key:2,class:"timeline-area"},Zt={class:"timeline-header"},Yt={class:"timeline-controls"},eo={class:"timeline-avatar font-display"},so={class:"timeline-info"},to={class:"timeline-name font-display"},oo={class:"timeline-phone font-mono"},ao={class:"timeline-prize"},lo={class:"timeline-level"},no={class:"timeline-prize-name"},$e=5e3,ro=10,io=16,uo=30,co=100,vo={__name:"Lottery",setup(k){const l=ws(),z=bs(),{userLoggedIn:N,currentUser:V,setUser:me,clearUser:fe}=Is(),g=n(!!localStorage.getItem("admin_token")),M=n(null),$=n("guest"),C=n({username:"",password:""}),X=n(!1),Z=n(!1),ge=n(!1),y=n({oldPassword:"",newPassword:"",confirmPassword:""}),Ke=async(t,e)=>e!==y.value.newPassword?Promise.reject("ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´"):Promise.resolve(),je=()=>{y.value={oldPassword:"",newPassword:"",confirmPassword:""},Z.value=!0},Ge=async()=>{var t,e;if(y.value.oldPassword&&y.value.newPassword&&!(y.value.newPassword.length<6)&&y.value.newPassword===y.value.confirmPassword){ge.value=!0;try{$.value==="user"?await F.post("/api/user/change-password",{old_password:y.value.oldPassword,new_password:y.value.newPassword}):await ks.post("/admin/change-password",{old_password:y.value.oldPassword,new_password:y.value.newPassword}),p.success("å¯†ç ä¿®æ”¹æˆåŠŸï¼Œè¯·é‡æ–°ç™»å½•"),Z.value=!1,setTimeout(()=>{Ae()},1e3)}catch(a){console.error("ä¿®æ”¹å¯†ç å¤±è´¥:",a),p.error(((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.error)||"ä¿®æ”¹å¯†ç å¤±è´¥ï¼Œè¯·æ£€æŸ¥å½“å‰å¯†ç æ˜¯å¦æ­£ç¡®")}finally{ge.value=!1}}},ye=async()=>{if(C.value.username&&C.value.password&&!(C.value.password.length<6)){X.value=!0;try{let t=l.query.company||r.value||"default";console.log("ç™»å½•æ—¶ä½¿ç”¨çš„å…¬å¸ä»£ç :",t);const e=await F.post("/api/login",{username:C.value.username,password:C.value.password},{params:{company_code:t}});e.user_type==="user"?(me({user:e.user,token:e.token}),N.value=!0,$.value="user",p.success("ç™»å½•æˆåŠŸï¼"),e.user.company&&(r.value=e.user.company.code,Y(e.user.company.code))):(localStorage.setItem("admin_token",e.token),localStorage.setItem("admin_user",JSON.stringify(e.user)),g.value=!0,M.value=e.user,$.value=e.user_type,e.user_type==="super_admin"?p.success("ğŸ‘‘ è¶…çº§ç®¡ç†å‘˜ç™»å½•æˆåŠŸï¼"):p.success("ğŸ‘¨â€ğŸ’¼ ç®¡ç†å‘˜ç™»å½•æˆåŠŸï¼"),e.user.company&&(r.value=e.user.company.code,Y(e.user.company.code))),await Je(r.value),await de(),console.log(`
âœ… ç™»å½•æˆåŠŸï¼Œå‡†å¤‡å¯åŠ¨æ•°æ®è½®è¯¢...`),ts()}catch(t){console.error("ç™»å½•å¤±è´¥:",t),t.response&&t.response.status===401?p.error("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"):p.error("ç™»å½•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}finally{X.value=!1}}},Ae=()=>{Se(),g.value?(localStorage.removeItem("admin_token"),localStorage.removeItem("admin_user"),g.value=!1,M.value=null):fe(),$.value="guest",p.info("å·²é€€å‡ºç™»å½•"),z.push("/")},qe=n(null),He=n(null),_e=n(null),ne=n(null),Me=n(null),K=n(null),r=n(""),{companyCode:po,setCompanyCode:Y,themeColor:we,title:mo,subtitle:fo,drawButtonText:go,successText:Xe}=Ss(),re=n([]),j=n({}),O=n([]),ie=n([]),w=n(!1),G=n(!1),T=n([]),ue=n(!1),Ze=n(!1),Ye=n(!1),es=n(!1),ce=n(!1),be=n(""),ss=()=>{ee.value||!ne.value||(ee.value=setInterval(()=>{const t=ne.value;t&&t.scrollBy({left:ro,behavior:"auto"})},io))},Ee=()=>{ee.value&&(clearInterval(ee.value),ee.value=null)},P=n(null),S=n(1),ee=n(null),Q=n(!0),se=n(null),he=x(()=>re.value.filter(t=>t.is_active&&t.total_stock-t.used_stock>0)),ke=x(()=>{if(!P.value)return 1;const t=re.value.find(e=>e.id===P.value);return t?t.total_stock-t.used_stock:1}),Fe=async()=>{await Je(),Ne()},Ne=()=>{const t=we.value||"#00fff5",e=(f,b)=>{const _=parseInt(f.slice(1,3),16),E=parseInt(f.slice(3,5),16),J=parseInt(f.slice(5,7),16);return`rgba(${_}, ${E}, ${J}, ${b})`},a=document.documentElement;a.style.setProperty("--company-color",t);const v=getComputedStyle(a).getPropertyValue("--bg-secondary").trim()||"#141420";a.style.setProperty("--company-color-bg",v),a.style.setProperty("--company-color-03",e(t,.03)),a.style.setProperty("--company-color-10",e(t,.1)),a.style.setProperty("--company-color-15",e(t,.15)),a.style.setProperty("--company-color-20",e(t,.2)),a.style.setProperty("--company-color-30",e(t,.3)),a.style.setProperty("--company-color-40",e(t,.4)),a.style.setProperty("--company-color-50",e(t,.5)),a.style.setProperty("--company-color-60",e(t,.6))};fs(we,()=>{Ne()},{immediate:!0});const xe=async()=>{try{if(!r.value){console.warn("âš ï¸ currentCompanyCode ä¸ºç©ºï¼Œè·³è¿‡è·å–å¥–é¡¹åˆ—è¡¨");return}console.log("ğŸ“Š æ­£åœ¨è·å–å¥–é¡¹åˆ—è¡¨ï¼Œcompany_code:",r.value);const t=await F.get(`/api/prize-levels?company_code=${r.value}`);re.value=t,console.log("âœ… å¥–é¡¹åˆ—è¡¨è·å–æˆåŠŸï¼Œå…±",(t==null?void 0:t.length)||0,"ä¸ªå¥–é¡¹")}catch(t){console.error("âŒ è·å–å¥–é¡¹åˆ—è¡¨å¤±è´¥:",t)}},Ce=async()=>{try{if(!r.value){console.warn("âš ï¸ currentCompanyCode ä¸ºç©ºï¼Œè·³è¿‡è·å–ç”¨æˆ·ç»Ÿè®¡");return}console.log("ğŸ“Š æ­£åœ¨è·å–ç”¨æˆ·ç»Ÿè®¡ï¼Œcompany_code:",r.value);const t=await F.get(`/api/user-stats?company_code=${r.value}`);j.value=t,console.log("âœ… ç”¨æˆ·ç»Ÿè®¡è·å–æˆåŠŸ:",t)}catch(t){console.error("âŒ è·å–ç”¨æˆ·ç»Ÿè®¡å¤±è´¥:",t)}},Pe=async()=>{try{if(!r.value){console.warn("âš ï¸ currentCompanyCode ä¸ºç©ºï¼Œè·³è¿‡è·å–æŠ½å¥–è®°å½•");return}console.log("ğŸ“Š æ­£åœ¨è·å–æŠ½å¥–è®°å½•ï¼Œcompany_code:",r.value);const t=await F.get(`/api/draw-records?company_code=${r.value}`);O.value=t||[],console.log("âœ… æŠ½å¥–è®°å½•è·å–æˆåŠŸï¼Œå…±",(t==null?void 0:t.length)||0,"æ¡è®°å½•")}catch(t){console.error("âŒ è·å–æŠ½å¥–è®°å½•å¤±è´¥:",t)}},de=async()=>{const t=new Date().toISOString();console.log(`
ğŸ”„ [${t}] å¼€å§‹åŠ è½½æ•°æ®...`);try{await Promise.all([xe(),Ce(),Pe()]),console.log("âœ… æ‰€æœ‰æ•°æ®åŠ è½½å®Œæˆ")}catch(e){console.error("âŒ åŠ è½½æ•°æ®å¤±è´¥:",e)}},ts=()=>{Se(),console.log("ğŸš€ ========== å¯åŠ¨æ•°æ®è½®è¯¢ =========="),console.log("â° è½®è¯¢é—´éš”:",$e,"ms (",$e/1e3,"ç§’)"),console.log("ğŸ¢ å½“å‰å…¬å¸ä»£ç :",r.value),console.log("==============================="),console.log("ğŸ“Š ç«‹å³æ‰§è¡Œé¦–æ¬¡æ•°æ®åˆ·æ–°..."),de(),K.value=setInterval(()=>{const t=new Date().toISOString();console.log(`
â° [${t}] å®šæ—¶å™¨è§¦å‘ - å‡†å¤‡åˆ·æ–°æ•°æ®`),de()},$e),console.log("âœ… æ•°æ®è½®è¯¢å·²å¯åŠ¨ï¼Œå®šæ—¶å™¨ID:",K.value)},Se=()=>{K.value?(clearInterval(K.value),console.log("ğŸ›‘ æ•°æ®è½®è¯¢å·²åœæ­¢ï¼Œå®šæ—¶å™¨ID:",K.value),K.value=null):console.log("â„¹ï¸  æ²¡æœ‰éœ€è¦åœæ­¢çš„è½®è¯¢å®šæ—¶å™¨")},os=async()=>{var t,e,a,v;try{if(console.log("å¼€å§‹è·å–äºŒç»´ç ï¼Œcompany_code:",r.value),!r.value){p.error("å…¬å¸ä»£ç ä¸ºç©ºï¼Œæ— æ³•è·å–äºŒç»´ç "),console.error("currentCompanyCode ä¸ºç©º");return}const f=`/api/qr-register?company_code=${r.value}`;console.log("API URL:",f);const b=await hs.get(f);console.log("è·å–åˆ°äºŒç»´ç æ•°æ®:",b?"æˆåŠŸ":"å¤±è´¥");const _=b.qr_code?b:b.data&&b.data.qr_code?b.data:null;console.log("äºŒç»´ç é•¿åº¦:",((t=_==null?void 0:_.qr_code)==null?void 0:t.length)||0),_&&_.qr_code?(be.value=_.qr_code,console.log("äºŒç»´ç å·²è®¾ç½®åˆ° registerQRCode")):(p.error("äºŒç»´ç æ•°æ®æ ¼å¼é”™è¯¯"),console.error("è¿”å›æ•°æ®ç¼ºå°‘ qr_code å­—æ®µ:",b))}catch(f){console.error("è·å–æ³¨å†ŒäºŒç»´ç å¤±è´¥:",f),console.error("é”™è¯¯è¯¦æƒ…:",((e=f.response)==null?void 0:e.data)||f.message),p.error(`è·å–äºŒç»´ç å¤±è´¥: ${((v=(a=f.response)==null?void 0:a.data)==null?void 0:v.error)||f.message}`)}},as=()=>{console.log("=== showQRModal è¢«è°ƒç”¨ ==="),console.log("å½“å‰ company_code:",r.value),console.log("qrModalVisible è®¾ç½®ä¸º:",ce.value),ce.value=!0,console.log("å‡†å¤‡è°ƒç”¨ fetchRegisterQRCode"),os(),console.log("=== showQRModal æ‰§è¡Œå®Œæ¯• ===")},Ve=async()=>{try{if(!r.value)return;const t=await F.get(`/api/available-users?company_code=${r.value}`);if(!t||t.length===0){const e=[],a=[{name:"å¼ ä¸‰",phone:"138****0001"},{name:"æå››",phone:"138****0002"},{name:"ç‹äº”",phone:"138****0003"},{name:"èµµå…­",phone:"138****0004"},{name:"é’±ä¸ƒ",phone:"138****0005"},{name:"å­™å…«",phone:"138****0006"},{name:"å‘¨ä¹",phone:"138****0007"}];for(let v=0;v<50;v++)e.push(...a);T.value=e}else{const e=[],a=Math.max(50,Math.ceil(350/t.length));for(let v=0;v<a;v++)e.push(...t);T.value=e}}catch(t){console.error("è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥:",t);const e=[],a=[{name:"å¼ ä¸‰",phone:"138****0001"},{name:"æå››",phone:"138****0002"},{name:"ç‹äº”",phone:"138****0003"},{name:"èµµå…­",phone:"138****0004"},{name:"é’±ä¸ƒ",phone:"138****0005"},{name:"å­™å…«",phone:"138****0006"},{name:"å‘¨ä¹",phone:"138****0007"}];for(let v=0;v<50;v++)e.push(...a);T.value=e}},ls=()=>{const t=qe.value;if(t)for(let e=0;e<20;e++){const a=document.createElement("div");a.className="particle",a.style.left=`${Math.random()*100}%`,a.style.top=`${Math.random()*100}%`,a.style.animationDelay=`${Math.random()*5}s`,a.style.animationDuration=`${5+Math.random()*10}s`,t.appendChild(a)}},ns=async()=>{if(!P.value){ue.value=!0;return}if(!S.value||S.value<=0)return;if(await Ve(),!T.value||T.value.length===0){p.error("ç”¨æˆ·åˆ—è¡¨ä¸ºç©ºï¼Œæ— æ³•å¼€å§‹æŠ½å¥–");return}const t=re.value.find(a=>a.id===P.value);if(!t){p.error("å¥–é¡¹ä¸å­˜åœ¨");return}if(!(t.total_stock-t.used_stock<S.value)){try{if(!r.value)return;const a=await F.get(`/api/user-stats?company_code=${r.value}`);if(!a.undrawn_users||a.undrawn_users===0){p.warning("æ‰€æœ‰ç”¨æˆ·éƒ½å·²æŠ½è¿‡å¥–");return}if(a.undrawn_users<S.value){p.warning(`æœªæŠ½å¥–ç”¨æˆ·ä¸è¶³${S.value}äººï¼Œå½“å‰åªæœ‰${a.undrawn_users}äºº`);return}}catch(a){console.error("æ£€æŸ¥ç”¨æˆ·çŠ¶æ€å¤±è´¥:",a),p.error("æ— æ³•æ£€æŸ¥ç”¨æˆ·çŠ¶æ€ï¼Œè¯·ç¨åé‡è¯•");return}w.value=!0,setTimeout(()=>{ss()},100)}},rs=async()=>{var J,ve;Ee();const t=ne.value,e=Me.value;if(!t||!e){p.error("æ— æ³•è·å–æ»šåŠ¨ä½ç½®"),w.value=!1;return}if(!T.value||T.value.length===0){p.error("ç”¨æˆ·æ•°æ®ä¸ºç©ºï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•"),w.value=!1;return}const a=t.scrollLeft,v=t.clientWidth,f=a+v/2,b=e.querySelectorAll(".user-item");if(b.length===0){p.error("æœªæ‰¾åˆ°ç”¨æˆ·å…ƒç´ ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•"),w.value=!1;return}let _=null,E=1/0;if(b.forEach((D,W)=>{const Re=D.offsetLeft,o=D.clientWidth,A=Re+o/2,B=Math.abs(f-A);B<E&&(E=B,W<T.value.length&&(_=T.value[W]))}),!_){p.error("æ— æ³•ç¡®å®šä¸­å¥–ç”¨æˆ·"),w.value=!1;return}try{if(!r.value){p.error("å…¬å¸ä¿¡æ¯å¼‚å¸¸ï¼Œè¯·é‡æ–°ç™»å½•"),w.value=!1;return}const D={level_id:P.value,count:S.value};_.phone&&!_.phone.includes("****")&&(D.user_phone=_.phone);const W=await F.post(`/api/draw?company_code=${r.value}`,D);ie.value=Array.isArray(W)?W:[W],G.value=!0,await Ce(),await Pe(),await xe(),w.value=!1,p.success(`ğŸ‰ æˆåŠŸæŠ½å–${ie.value.length}ä½ä¸­å¥–è€…ï¼`),Ze.value=!1,Ye.value=!1,es.value=!1}catch(D){console.error("æŠ½å¥–å¤±è´¥:",D),p.error(((ve=(J=D.response)==null?void 0:J.data)==null?void 0:ve.error)||"æŠ½å¥–å¤±è´¥"),w.value=!1}},is=()=>{G.value=!1,ie.value=[],P.value=null,S.value=1,ue.value=!1},Ie=t=>!t||t.length<7?t:t.substring(0,3)+"****"+t.substring(7),us=t=>t.includes("ä¸€ç­‰")?"ä¸€ç­‰å¥–":t.includes("äºŒç­‰")?"äºŒç­‰å¥–":t.includes("ä¸‰ç­‰")?"ä¸‰ç­‰å¥–":t.includes("å‚ä¸")?"å‚ä¸å¥–":"å¹¸è¿å¥–",cs=t=>t.includes("ä¸€ç­‰")?"#f50":t.includes("äºŒç­‰")?"#fa8c16":t.includes("ä¸‰ç­‰")?"#52c41a":t.includes("å‚ä¸")?"#108ee9":"#722ed1",ds=t=>{const a=(t.total_stock-t.used_stock)/t.total_stock*100;return a===0?"#ff4d4f":a<20?"#faad14":a<50?"#1890ff":"#52c41a"},We=async()=>{(l.path==="/lottery"||l.path.startsWith("/lottery?"))&&await Fe()},Le=()=>{se.value||!_e.value||(se.value=setInterval(()=>{const t=_e.value;if(!t)return;const e=t.scrollLeft,a=t.scrollWidth-t.clientWidth;e>=a-1?t.scrollTo({left:0,behavior:"auto"}):t.scrollBy({left:uo,behavior:"smooth"})},co))},Ue=()=>{se.value&&(clearInterval(se.value),se.value=null)},vs=()=>{Q.value?(Ue(),Q.value=!1):(Le(),Q.value=!0)},ps=()=>{Q.value&&Ue()},ms=()=>{Q.value&&Le()};return gs(async()=>{const t=l.query.company;t&&!r.value&&(r.value=t,Y(t),console.log("ä»è·¯ç”±è®¾ç½®å…¬å¸ä»£ç :",r.value));const e=localStorage.getItem("admin_token"),a=localStorage.getItem("admin_user");if(e&&a)try{M.value=JSON.parse(a),g.value=!0,M.value.company&&M.value.company.code&&(r.value=M.value.company.code,Y(M.value.company.code),console.log("ä»ç®¡ç†å‘˜ä¿¡æ¯è®¾ç½®å…¬å¸ä»£ç :",r.value))}catch(v){console.error("è§£æç®¡ç†å‘˜ä¿¡æ¯å¤±è´¥:",v),localStorage.removeItem("admin_token"),localStorage.removeItem("admin_user")}r.value||(r.value="DEFAULT",Y("DEFAULT"),console.log("ä½¿ç”¨é»˜è®¤å…¬å¸ä»£ç :",r.value)),N.value||g.value?(console.log("å¼€å§‹åŠ è½½æ•°æ®ï¼Œå…¬å¸ä»£ç :",r.value),await Fe(),await xe(),await Ce(),await Pe()):companyConfig.value=L,ls(),he.value.length>0&&(P.value=he.value[0].id),window.addEventListener("focus",We),await Ve(),O.value.length>0&&setTimeout(()=>{Le()},100)}),ys(()=>{window.removeEventListener("focus",We),Ue(),Ee(),Se()}),(t,e)=>{const a=U("a-input"),v=U("a-form-item"),f=U("a-input-password"),b=U("a-form"),_=U("a-tag"),E=U("a-button"),J=U("a-modal"),ve=U("a-spin"),D=U("a-select-option"),W=U("a-select"),Re=U("a-input-number");return u(),d("div",{class:"lottery-page",style:ze({"--company-color":q(we)})},[!q(N)&&!g.value?(u(),d("div",Ls,[s("div",Us,[e[14]||(e[14]=s("div",{class:"login-header"},[s("div",{class:"login-icon"},"ğŸ°"),s("h1",{class:"login-title font-display"},"å¹¸è¿æŠ½å¥–"),s("p",{class:"login-subtitle font-body"},"è¯·ç™»å½•åå¼€å§‹æŠ½å¥–")],-1)),c(b,{layout:"vertical",class:"login-form"},{default:m(()=>[c(v,{label:"ç”¨æˆ·å"},{default:m(()=>[c(a,{value:C.value.username,"onUpdate:value":e[0]||(e[0]=o=>C.value.username=o),placeholder:"è¯·è¾“å…¥ç”¨æˆ·å",size:"large",onKeyup:Qe(ye,["enter"])},{prefix:m(()=>[...e[12]||(e[12]=[s("span",null,"ğŸ‘¤",-1)])]),_:1},8,["value"])]),_:1}),c(v,{label:"å¯†ç "},{default:m(()=>[c(f,{value:C.value.password,"onUpdate:value":e[1]||(e[1]=o=>C.value.password=o),placeholder:"è¯·è¾“å…¥å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰",size:"large",onKeyup:Qe(ye,["enter"])},{prefix:m(()=>[...e[13]||(e[13]=[s("span",null,"ğŸ”‘",-1)])]),_:1},8,["value"])]),_:1}),c(v,null,{default:m(()=>[s("button",{type:"button",onClick:ye,class:pe(["login-button font-display",{loading:X.value}]),disabled:!C.value.username||!C.value.password||C.value.password.length<6},[X.value?(u(),d("span",zs)):h("",!0),s("span",null,i(X.value?"ç™»å½•ä¸­...":"ğŸš€ ç™»å½•"),1)],10,Rs)]),_:1})]),_:1}),e[15]||(e[15]=s("div",{class:"login-tips"},[s("p",{class:"tip-text font-body"},"ğŸ’¡ æ²¡æœ‰è´¦å·è¯·è”ç³»ç®¡ç†å‘˜åˆ›å»º")],-1))])])):(u(),d(H,{key:1},[s("div",$s,[e[16]||(e[16]=s("div",{class:"gradient-orb orb-cyan"},null,-1)),e[17]||(e[17]=s("div",{class:"gradient-orb orb-magenta"},null,-1)),e[18]||(e[18]=s("div",{class:"grid-overlay"},null,-1)),s("div",{class:"particles",ref_key:"particlesRef",ref:qe},null,512)]),s("div",Ts,[s("div",Ds,[s("div",As,[s("span",qs,i($.value==="super_admin"?"ğŸ‘‘":$.value==="admin"?"ğŸ‘¨â€ğŸ’¼":"ğŸ‘¤"),1),s("span",Ms,[I(i(q(V).name||q(V).username)+" ",1),$.value!=="user"&&$.value!=="guest"?(u(),Oe(_,{key:0,color:$.value==="super_admin"?"gold":"cyan",style:{"margin-left":"8px"}},{default:m(()=>[I(i($.value==="super_admin"?"è¶…çº§ç®¡ç†å‘˜":"ç®¡ç†å‘˜"),1)]),_:1},8,["color"])):h("",!0)])]),e[25]||(e[25]=s("div",{class:"status-divider"},null,-1)),s("div",Es,[e[19]||(e[19]=s("span",{class:"status-icon"},"ğŸ†",-1)),e[20]||(e[20]=s("span",{class:"status-label font-body"},"æœ¬åœºä¸­å¥–",-1)),s("span",Fs,i(O.value.length),1)]),e[26]||(e[26]=s("div",{class:"status-divider"},null,-1)),s("div",Ns,[e[21]||(e[21]=s("span",{class:"status-icon"},"ğŸ‘¥",-1)),e[22]||(e[22]=s("span",{class:"status-label font-body"},"å‚ä¸äººæ•°",-1)),s("span",Vs,i(j.value.total_users||0),1)]),e[27]||(e[27]=s("div",{class:"status-divider"},null,-1)),s("div",{class:"status-item",onClick:je,style:{cursor:"pointer"}},[...e[23]||(e[23]=[s("span",{class:"status-icon"},"ğŸ”",-1),s("span",{class:"status-label font-body"},"ä¿®æ”¹å¯†ç ",-1)])]),e[28]||(e[28]=s("div",{class:"status-divider"},null,-1)),s("div",{class:"status-item logout-action",onClick:Ae},[...e[24]||(e[24]=[s("span",{class:"status-icon"},"ğŸšª",-1),s("span",{class:"status-label font-body"},"é€€å‡º",-1)])])])]),c(J,{open:Z.value,"onUpdate:open":e[6]||(e[6]=o=>Z.value=o),title:"ä¿®æ”¹å¯†ç ",footer:null,width:"400px"},{default:m(()=>[c(b,{model:y.value,layout:"vertical",onFinish:Ge},{default:m(()=>[c(v,{label:"å½“å‰å¯†ç ",name:"oldPassword",rules:[{required:!0,message:"è¯·è¾“å…¥å½“å‰å¯†ç "}]},{default:m(()=>[c(f,{value:y.value.oldPassword,"onUpdate:value":e[2]||(e[2]=o=>y.value.oldPassword=o),placeholder:"è¯·è¾“å…¥å½“å‰å¯†ç ",size:"large"},null,8,["value"])]),_:1}),c(v,{label:"æ–°å¯†ç ",name:"newPassword",rules:[{required:!0,message:"è¯·è¾“å…¥æ–°å¯†ç "},{min:6,message:"å¯†ç é•¿åº¦è‡³å°‘6ä½"}]},{default:m(()=>[c(f,{value:y.value.newPassword,"onUpdate:value":e[3]||(e[3]=o=>y.value.newPassword=o),placeholder:"è¯·è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰",size:"large"},null,8,["value"])]),_:1}),c(v,{label:"ç¡®è®¤å¯†ç ",name:"confirmPassword",rules:[{required:!0,message:"è¯·ç¡®è®¤æ–°å¯†ç "},{validator:Ke}]},{default:m(()=>[c(f,{value:y.value.confirmPassword,"onUpdate:value":e[4]||(e[4]=o=>y.value.confirmPassword=o),placeholder:"è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ",size:"large"},null,8,["value"])]),_:1},8,["rules"]),c(v,null,{default:m(()=>[c(E,{type:"primary","html-type":"submit",loading:ge.value,block:"",size:"large"},{default:m(()=>[...e[29]||(e[29]=[I(" ç¡®è®¤ä¿®æ”¹ ",-1)])]),_:1},8,["loading"]),c(E,{style:{"margin-top":"8px"},block:"",size:"large",onClick:e[5]||(e[5]=o=>Z.value=!1)},{default:m(()=>[...e[30]||(e[30]=[I(" å–æ¶ˆ ",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["open"]),c(J,{open:ce.value,"onUpdate:open":e[7]||(e[7]=o=>ce.value=o),title:"æ‰«ç å‚ä¸æŠ½å¥–",footer:null,width:"400px"},{default:m(()=>[s("div",Ws,[be.value?(u(),d("div",Os,[s("img",{src:be.value,alt:"æ³¨å†ŒäºŒç»´ç ",style:{width:"100%","max-width":"280px",border:"4px solid #667eea","border-radius":"12px",padding:"8px",background:"white"}},null,8,Qs),e[32]||(e[32]=s("div",{style:{"margin-top":"24px",padding:"20px",background:"rgba(102, 126, 234, 0.05)","border-radius":"12px",border:"1px solid rgba(102, 126, 234, 0.2)"}},[s("p",{style:{margin:"12px 0","font-size":"14px",color:"#333"}},"ğŸ“± æ‰“å¼€æ‰‹æœºç›¸æœºæˆ–å¾®ä¿¡æ‰«ä¸€æ‰«"),s("p",{style:{margin:"12px 0","font-size":"14px",color:"#333"}},"ğŸ” æ‰«æä¸Šæ–¹äºŒç»´ç "),s("p",{style:{margin:"12px 0","font-size":"14px",color:"#333"}},"âœï¸ å¡«å†™ä¿¡æ¯å®Œæˆæ³¨å†Œ"),s("p",{style:{margin:"12px 0","font-size":"12px",color:"#666"}},"æ³¨å†ŒæˆåŠŸåå°†è‡ªåŠ¨åŠ å…¥æŠ½å¥–æ± ")],-1))])):(u(),d("div",Bs,[c(ve,{size:"large"}),e[31]||(e[31]=s("p",{style:{"margin-top":"16px",color:"#666"}},"åŠ è½½äºŒç»´ç ä¸­...",-1))]))])]),_:1},8,["open"]),s("div",Js,[s("div",Ks,[s("div",js,[e[33]||(e[33]=s("span",{class:"status-icon"},"ğŸ†",-1)),e[34]||(e[34]=s("span",{class:"status-label font-body"},"æœ¬åœºä¸­å¥–",-1)),s("span",Gs,i(O.value.length),1)]),e[37]||(e[37]=s("div",{class:"status-divider"},null,-1)),s("div",Hs,[e[35]||(e[35]=s("span",{class:"status-icon"},"ğŸ‘¥",-1)),e[36]||(e[36]=s("span",{class:"status-label font-body"},"å‚ä¸äººæ•°",-1)),s("span",Xs,i(j.value.total_users||0),1)]),e[38]||(e[38]=_s('<div class="status-divider" data-v-b0aab843></div><div class="status-item" data-v-b0aab843><span class="status-icon" data-v-b0aab843>â±ï¸</span><span class="status-label font-body" data-v-b0aab843>æ´»åŠ¨çŠ¶æ€</span><span class="status-indicator live" data-v-b0aab843>è¿›è¡Œä¸­</span></div>',2))])]),s("div",Zs,[s("div",Ys,[s("div",et,[s("div",st,[G.value?h("",!0):(u(),d("div",tt,[w.value?(u(),d("div",{key:0,class:"rolling-container",ref_key:"rollingContainerRef",ref:ne},[s("div",{class:"rolling-track",ref_key:"rollingTrackRef",ref:Me},[(u(!0),d(H,null,le(T.value,(o,A)=>(u(),d("div",{key:`${A}-${o.name}`,class:"user-item","data-index":A},[s("div",at,i(o.name),1),s("div",lt,i(Ie(o.phone)),1)],8,ot))),128))],512)],512)):h("",!0),w.value?(u(),d("div",nt,[...e[39]||(e[39]=[s("div",{class:"highlight-indicator"},null,-1)])])):h("",!0),w.value?h("",!0):(u(),d("div",rt,[...e[40]||(e[40]=[s("div",{class:"waiting-icon"},"ğŸ°",-1),s("h2",{class:"waiting-title font-display"},"å‡†å¤‡æŠ½å¥–",-1)])])),w.value?(u(),d("div",it)):h("",!0),w.value?(u(),d("button",{key:4,onClick:rs,class:"stop-draw-btn font-display mega-btn"}," ğŸ›‘ åœæ­¢æŠ½å¥– ")):h("",!0)])),G.value?(u(),d("div",ut,[e[41]||(e[41]=s("div",{class:"result-icon"},"ğŸ",-1)),s("h2",ct,i(q(Xe)),1),s("div",dt,[(u(!0),d(H,null,le(ie.value,(o,A)=>{var B,te,oe,ae,Be;return u(),d("div",{key:o.id,class:"winner-card winner-card-mega glass",style:ze({animationDelay:`${A*.15}s`})},[s("div",vt,i((((B=o.user)==null?void 0:B.name)||"æœªçŸ¥")[0]),1),s("div",pt,[s("div",mt,i((te=o.user)==null?void 0:te.name),1),s("div",ft,i(Ie((oe=o.user)==null?void 0:oe.phone)),1)]),s("div",gt,[s("div",yt,i((ae=o.level)==null?void 0:ae.name),1),s("div",_t,i((Be=o.prize)==null?void 0:Be.name),1)])],4)}),128))]),s("button",{onClick:is,class:"continue-btn font-display mega-btn"}," ç»§ç»­æŠ½å¥– â†’ ")])):h("",!0)])])]),!G.value&&(q(N)||g.value)?(u(),d("div",wt,[s("div",bt,[e[51]||(e[51]=s("div",{class:"config-header"},[s("h3",{class:"config-title font-display"},"ğŸ® æ§åˆ¶é¢æ¿")],-1)),s("div",ht,[s("div",kt,[c(E,{onClick:e[8]||(e[8]=()=>{de(),q(p).success("æ•°æ®å·²åˆ·æ–°")}),size:"large",block:"",style:{background:"linear-gradient(135deg, #52c41a 0%, #73d13d 100%)",border:"none",color:"white",height:"40px","font-size":"14px","font-weight":"bold","margin-bottom":"12px"}},{default:m(()=>[c(q(Cs),{spin:!1}),e[42]||(e[42]=I(" ğŸ”„ åˆ·æ–°æ•°æ® ",-1))]),_:1}),e[43]||(e[43]=s("p",{style:{"text-align":"center",color:"#999","font-size":"11px","margin-top":"-8px","margin-bottom":"12px"}}," æ•°æ®æ¯ 5 ç§’è‡ªåŠ¨åˆ·æ–° ",-1))]),s("div",xt,[c(E,{onClick:e[9]||(e[9]=()=>{console.log("æŒ‰é’®è¢«ç‚¹å‡»"),as()}),size:"large",block:"",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none",color:"white",height:"48px","font-size":"16px","font-weight":"bold","margin-bottom":"16px"}},{default:m(()=>[c(q(Ps)),e[44]||(e[44]=I(" ğŸ“± æ‰«ç å‚ä¸æŠ½å¥– ",-1))]),_:1}),e[45]||(e[45]=s("p",{style:{"text-align":"center",color:"#999","font-size":"12px","margin-top":"-8px","margin-bottom":"16px"}}," ç‚¹å‡»æŸ¥çœ‹äºŒç»´ç ï¼Œç”¨æˆ·æ‰«ç å³å¯æ³¨å†Œ ",-1))]),s("div",Ct,[e[47]||(e[47]=s("label",{class:"form-label font-body"},"é€‰æ‹©å¥–é¡¹ç­‰çº§",-1)),c(W,{value:P.value,"onUpdate:value":e[10]||(e[10]=o=>P.value=o),placeholder:"è¯·é€‰æ‹©è¦æŠ½å–çš„å¥–é¡¹",size:"large",class:"neon-select",status:!P.value&&ue.value?"error":""},{default:m(()=>[(u(!0),d(H,null,le(he.value,o=>(u(),Oe(D,{key:o.id,value:o.id},{default:m(()=>[s("div",Pt,[s("div",St,[s("span",It,i(o.name),1),c(_,{color:cs(o.name),class:"level-tag"},{default:m(()=>[I(i(us(o.name)),1)]),_:2},1032,["color"])]),s("div",Lt,[s("span",Ut,[e[46]||(e[46]=I(" å‰©ä½™: ",-1)),s("strong",{style:ze({color:ds(o)})},i(o.total_stock-o.used_stock),5),I(" / "+i(o.total_stock),1)])])])]),_:2},1032,["value"]))),128))]),_:1},8,["value","status"]),!P.value&&ue.value?(u(),d("div",Rt," è¯·é€‰æ‹©å¥–é¡¹ç­‰çº§ ")):h("",!0)]),s("div",zt,[e[50]||(e[50]=s("label",{class:"form-label font-body"},"æŠ½å–äººæ•°",-1)),s("div",$t,[c(Re,{value:S.value,"onUpdate:value":e[11]||(e[11]=o=>S.value=o),min:1,max:ke.value,size:"large",class:"neon-input-number"},null,8,["value","max"]),s("div",Tt,[(u(),d(H,null,le([1,3,5,10],o=>s("button",{key:o,class:pe(["quick-count-btn font-display",{active:S.value===o}]),onClick:A=>S.value=o,disabled:o>ke.value},i(o)+"äºº ",11,Dt)),64))])]),s("div",At,[e[48]||(e[48]=I(" ğŸ’¡ æœ€å¤šå¯æŠ½ ",-1)),s("strong",null,i(ke.value),1),e[49]||(e[49]=I(" äºº ",-1))])]),s("div",qt,[s("button",{onClick:ns,class:pe(["draw-button font-display mega-draw-btn",{drawing:w.value}]),disabled:!P.value||!S.value||w.value},[w.value?(u(),d("span",Et)):h("",!0),s("span",null,i(w.value?"æŠ½å¥–ä¸­...":"ğŸ° å¼€å§‹æŠ½å¥–"),1)],10,Mt)])])])])):h("",!0),!G.value&&!(q(N)||g.value)?(u(),d("div",Ft,[s("div",Nt,[e[59]||(e[59]=s("div",{class:"config-header"},[s("h3",{class:"config-title font-display"},"ğŸ“‹ æŠ½å¥–ä¿¡æ¯")],-1)),s("div",Vt,[s("div",Wt,[e[53]||(e[53]=s("span",{class:"info-icon"},"ğŸ‘¥",-1)),s("div",Bt,[e[52]||(e[52]=s("div",{class:"info-label"},"å‚ä¸äººæ•°",-1)),s("div",Ot,i(j.value.total_users||0),1)])]),s("div",Qt,[e[55]||(e[55]=s("span",{class:"info-icon"},"ğŸ¯",-1)),s("div",Jt,[e[54]||(e[54]=s("div",{class:"info-label"},"å·²æŠ½å¥–",-1)),s("div",Kt,i(j.value.drawn_users||0),1)])]),s("div",jt,[e[57]||(e[57]=s("span",{class:"info-icon"},"â³",-1)),s("div",Gt,[e[56]||(e[56]=s("div",{class:"info-label"},"å¾…æŠ½å¥–",-1)),s("div",Ht,i(j.value.undrawn_users||0),1)])]),e[58]||(e[58]=s("div",{class:"user-notice-banner"},[s("span",{class:"notice-icon"},"ğŸ“‹"),s("p",{class:"notice-text font-body"}," æŠ½å¥–æ´»åŠ¨ç”±ç®¡ç†å‘˜ä¸»æŒï¼Œè¯·ç­‰å¾…ç®¡ç†å‘˜å¼€å§‹æŠ½å¥– ")],-1))])])])):h("",!0),O.value.length>0?(u(),d("div",Xt,[s("div",Zt,[e[60]||(e[60]=s("h3",{class:"timeline-title font-display"},"ğŸ† ä¸­å¥–å†å²",-1)),s("div",Yt,[c(_,{color:"success",class:"count-badge"},{default:m(()=>[I(i(O.value.length)+"äºº",1)]),_:1}),s("button",{onClick:vs,class:pe(["scroll-toggle font-body",{paused:!Q.value}])},i(Q.value?"â¸":"â–¶ï¸"),3)])]),s("div",{class:"winners-timeline",ref_key:"timelineContainerRef",ref:_e,onMouseenter:ps,onMouseleave:ms},[s("div",{class:"timeline-track",ref_key:"timelineRef",ref:He},[(u(!0),d(H,null,le(O.value.slice().reverse(),o=>{var A,B,te,oe,ae;return u(),d("div",{key:o.id,class:"timeline-item glass"},[s("div",eo,i((((A=o.user)==null?void 0:A.name)||"æœªçŸ¥")[0]),1),s("div",so,[s("div",to,i((B=o.user)==null?void 0:B.name),1),s("div",oo,i(Ie((te=o.user)==null?void 0:te.phone)),1)]),s("div",ao,[s("div",lo,i((oe=o.level)==null?void 0:oe.name),1),s("div",no,i((ae=o.prize)==null?void 0:ae.name),1)])])}),128))],512)],544)])):h("",!0)])],64))],4)}}},So=xs(vo,[["__scopeId","data-v-b0aab843"]]);export{So as default};
