import{r as $}from"./request-5e349af4.js";import{_ as me}from"./_plugin-vue_export-helper-c27b6911.js";import{P as _e,ah as fe,ai as ye,ag as ge,N as J}from"./antd-icons-bbb5d9cb.js";import{j as K,o as be,U as d,V as p,_ as b,Z as a,c as s,X as l,a4 as c,F as S,a1 as j,W as z,a0 as Q,r as m,G as i,u as I,a3 as Y}from"./vue-vendor-6562d100.js";import{m as u}from"./antd-vue-e1953b5a.js";import"./axios-78d57de0.js";import"./vendor-a94b8c86.js";import"./dayjs-793f537c.js";const we={class:"users-page"},he={class:"page-header"},ke={class:"header-right"},xe={class:"stats-cards"},Ue={class:"stat-card"},Ce={class:"stat-content"},$e={class:"stat-value"},ze={class:"stat-card"},Ie={class:"stat-content"},Oe={class:"stat-value"},Ve={class:"stat-card"},Me={class:"stat-content"},Be={class:"stat-value"},Fe={class:"stat-card"},Ne={class:"stat-content"},Le={class:"stat-value"},Te={class:"toolbar"},Ae={class:"view-switcher"},De={key:0,class:"table-view"},Se={key:0,class:"user-cell"},je={class:"user-avatar"},Ee={class:"user-info"},Pe={class:"user-name font-body"},qe={class:"user-phone"},Ge={key:1,class:"card-view"},Re={class:"users-grid"},We={class:"user-card-header"},Xe={class:"user-avatar-large"},Ze={class:"user-card-body"},He={class:"user-card-name"},Je={class:"user-card-phone"},Ke={class:"user-card-actions"},Qe={__name:"Users",setup(Ye){const E=m("table"),A=m(""),P=m(!1),q=m([]),D=m([]),h=m(null),k=m({total_users:0,undrawn_users:0,drawn_users:0}),O=m(!1),r=m({company_id:null,name:"",phone:""}),V=m(!1),v=m({id:null,username:"",name:"",phone:"",has_drawn:!1}),M=m(!1),_=m({company_id:null,users:""}),Z=m({current:1,pageSize:12,total:0,showSizeChanger:!0,showTotal:n=>`å…± ${n} æ¡`}),ee=[{title:"ID",dataIndex:"id",key:"id",width:80},{title:"ç”¨æˆ·ä¿¡æ¯",key:"name",width:300},{title:"ç”¨æˆ·å",dataIndex:"username",key:"username",width:150},{title:"æŠ½å¥–çŠ¶æ€",key:"has_drawn",width:120},{title:"æ“ä½œ",key:"action",width:120,fixed:"right"}],ae=K(()=>k.value.total_users===0?0:(k.value.drawn_users/k.value.total_users*100).toFixed(1)),G=K(()=>{if(!A.value)return q.value;const n=A.value.toLowerCase();return q.value.filter(e=>e.name&&e.name.toLowerCase().includes(n)||e.phone&&e.phone.includes(n))}),te=async()=>{try{const n=await $.get("/admin/companies");D.value=n,n.length>0&&(h.value=n[0].id,await x())}catch{u.error("è·å–å…¬å¸åˆ—è¡¨å¤±è´¥")}},x=async()=>{if(h.value){P.value=!0;try{const n=await $.get(`/admin/users?company_id=${h.value}`);q.value=n,Z.value.total=n.length,k.value={total_users:n.length,undrawn_users:n.filter(e=>!e.has_drawn).length,drawn_users:n.filter(e=>e.has_drawn).length}}catch{u.error("è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥")}finally{P.value=!1}}},se=()=>{r.value={company_id:h.value,username:"",password:"",name:"",phone:""},O.value=!0},le=async()=>{var n,e;if(!r.value.company_id||!r.value.name){u.warning("è¯·å¡«å†™å…¬å¸å’Œå§“å");return}r.value.name=r.value.name.trim(),r.value.phone&&(r.value.phone=r.value.phone.trim());try{await $.post("/admin/users",{company_id:r.value.company_id,name:r.value.name,phone:r.value.phone}),u.success("æ·»åŠ æˆåŠŸ"),O.value=!1,await x()}catch(f){u.error(((e=(n=f.response)==null?void 0:n.data)==null?void 0:e.error)||"æ·»åŠ å¤±è´¥")}},ne=()=>{_.value={company_id:h.value,users:""},M.value=!0},oe=async()=>{var w,B;if(!_.value.company_id||!_.value.users.trim()){u.warning("è¯·é€‰æ‹©å…¬å¸å¹¶å¡«å†™ç”¨æˆ·æ•°æ®");return}const e=_.value.users.trim().split(`
`).map(o=>o.trim()).filter(o=>o.length>0);if(e.length===0){u.warning("è¯·è¾“å…¥è‡³å°‘ä¸€ä¸ªç”¨æˆ·");return}const f=[],U=[];if(e.forEach((o,F)=>{const N=o.split(","),C=N[0].trim(),L=N[1]?N[1].trim():"";C?U.push(L?`${C},${L}`:C):f.push(`ç¬¬${F+1}è¡Œ: ${o}ï¼ˆå§“åä¸ºç©ºï¼‰`)}),f.length>0){u.error(`æ ¼å¼é”™è¯¯ï¼š
${f.join(`
`)}`);return}try{const o=await $.post("/admin/users/batch",{company_id:_.value.company_id,users:U});M.value=!1,o.failed===0?u.success(`âœ… æˆåŠŸå¯¼å…¥ ${o.created} ä¸ªç”¨æˆ·`):u.warning(`âš ï¸ æˆåŠŸ ${o.created} ä¸ªï¼Œå¤±è´¥ ${o.failed} ä¸ª`),o.errors&&o.errors.length>0&&console.log("å¯¼å…¥å¤±è´¥çš„ç”¨æˆ·:",o.errors),await x()}catch(o){const F=((B=(w=o.response)==null?void 0:w.data)==null?void 0:B.error)||"å¯¼å…¥å¤±è´¥";u.error(`âŒ ${F}`),console.error("æ‰¹é‡å¯¼å…¥å¤±è´¥:",o)}},H=async n=>{try{await $.delete(`/admin/users/${n}`),u.success("åˆ é™¤æˆåŠŸ"),await x()}catch{u.error("åˆ é™¤å¤±è´¥")}},re=n=>{v.value={id:n.id,username:n.username,name:n.name||"",phone:n.phone||"",has_drawn:n.has_drawn},V.value=!0},de=async()=>{if(!v.value.name){u.warning("è¯·å¡«å†™å§“å");return}try{await $.put(`/admin/users/${v.value.id}`,{name:v.value.name,phone:v.value.phone,has_drawn:v.value.has_drawn}),u.success("æ›´æ–°æˆåŠŸ"),V.value=!1,await x()}catch{u.error("æ›´æ–°å¤±è´¥")}};return be(()=>{te()}),(n,e)=>{const f=d("a-select-option"),U=d("a-select"),w=d("a-button"),B=d("a-space"),o=d("a-radio-button"),F=d("a-radio-group"),N=d("a-input-search"),C=d("a-tag"),L=d("a-popconfirm"),ie=d("a-table"),ue=d("a-empty"),y=d("a-form-item"),T=d("a-input"),R=d("a-alert"),W=d("a-form"),X=d("a-modal"),ve=d("a-switch"),pe=d("a-textarea");return p(),b("div",we,[a("div",he,[e[20]||(e[20]=a("div",{class:"header-left"},[a("h1",{class:"page-title font-display"},"ğŸ‘¥ ç”¨æˆ·ç®¡ç†"),a("p",{class:"page-subtitle font-body"},"ç®¡ç†å‚ä¸æŠ½å¥–çš„ç”¨æˆ·ä¿¡æ¯")],-1)),a("div",ke,[s(B,{wrap:!0},{default:l(()=>[s(U,{value:h.value,"onUpdate:value":e[0]||(e[0]=t=>h.value=t),style:{width:"200px"},placeholder:"é€‰æ‹©å…¬å¸",onChange:x,class:"company-select neon-select"},{default:l(()=>[(p(!0),b(S,null,j(D.value,t=>(p(),z(f,{key:t.id,value:t.id},{default:l(()=>[i(c(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),s(w,{type:"primary",onClick:se,class:"add-btn neon-button",size:"large"},{default:l(()=>[s(I(_e)),e[18]||(e[18]=i(" æ·»åŠ ç”¨æˆ· ",-1))]),_:1}),s(w,{onClick:ne,class:"neon-button-secondary",size:"large"},{default:l(()=>[s(I(fe)),e[19]||(e[19]=i(" æ‰¹é‡å¯¼å…¥ ",-1))]),_:1})]),_:1})])]),a("div",xe,[a("div",Ue,[e[22]||(e[22]=a("div",{class:"stat-icon",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}}," ğŸ‘¥ ",-1)),a("div",Ce,[a("div",$e,c(k.value.total_users),1),e[21]||(e[21]=a("div",{class:"stat-label font-body"},"æ€»ç”¨æˆ·æ•°",-1))])]),a("div",ze,[e[24]||(e[24]=a("div",{class:"stat-icon",style:{background:"linear-gradient(135deg, #52c41a 0%, #73d13d 100%)"}}," ğŸ° ",-1)),a("div",Ie,[a("div",Oe,c(k.value.drawn_users),1),e[23]||(e[23]=a("div",{class:"stat-label font-body"},"å·²æŠ½å¥–",-1))])]),a("div",Ve,[e[26]||(e[26]=a("div",{class:"stat-icon",style:{background:"linear-gradient(135deg, #1890ff 0%, #40a9ff 100%)"}}," â³ ",-1)),a("div",Me,[a("div",Be,c(k.value.undrawn_users),1),e[25]||(e[25]=a("div",{class:"stat-label font-body"},"æœªæŠ½å¥–",-1))])]),a("div",Fe,[e[28]||(e[28]=a("div",{class:"stat-icon",style:{background:"linear-gradient(135deg, #faad14 0%, #ffc53d 100%)"}}," ğŸ“Š ",-1)),a("div",Ne,[a("div",Le,c(ae.value)+"%",1),e[27]||(e[27]=a("div",{class:"stat-label font-body"},"æŠ½å¥–ç‡",-1))])])]),a("div",Te,[a("div",Ae,[s(F,{value:E.value,"onUpdate:value":e[1]||(e[1]=t=>E.value=t),"button-style":"solid"},{default:l(()=>[s(o,{value:"table"},{default:l(()=>[s(I(ye)),e[29]||(e[29]=i(" è¡¨æ ¼ ",-1))]),_:1}),s(o,{value:"card"},{default:l(()=>[s(I(ge)),e[30]||(e[30]=i(" å¡ç‰‡ ",-1))]),_:1})]),_:1},8,["value"])]),s(N,{value:A.value,"onUpdate:value":e[2]||(e[2]=t=>A.value=t),placeholder:"æœç´¢å§“åæˆ–ç”¨æˆ·å",style:{width:"300px"},"allow-clear":""},null,8,["value"])]),E.value==="table"?(p(),b("div",De,[s(ie,{columns:ee,"data-source":G.value,loading:P.value,pagination:Z.value,"row-key":"id",class:"users-table"},{bodyCell:l(({column:t,record:g})=>[t.key==="name"?(p(),b("div",Se,[a("div",je,c((g.name||"æœª")[0]),1),a("div",Ee,[a("div",Pe,c(g.name||"æœªè®¾ç½®"),1),a("div",qe,"@"+c(g.username),1)])])):t.key==="has_drawn"?(p(),z(C,{key:1,color:g.has_drawn?"success":"default"},{default:l(()=>[a("span",{class:Y(["status-dot",{active:g.has_drawn}])},null,2),i(" "+c(g.has_drawn?"å·²æŠ½å¥–":"æœªæŠ½å¥–"),1)]),_:2},1032,["color"])):t.key==="action"?(p(),z(B,{key:2},{default:l(()=>[s(w,{type:"link",size:"small",onClick:ce=>re(g)},{default:l(()=>[...e[31]||(e[31]=[i(" ç¼–è¾‘ ",-1)])]),_:1},8,["onClick"]),s(L,{title:"ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç”¨æˆ·å—ï¼Ÿ",onConfirm:ce=>H(g.id)},{default:l(()=>[s(w,{type:"link",danger:"",size:"small"},{default:l(()=>[s(I(J)),e[32]||(e[32]=i(" åˆ é™¤ ",-1))]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)):Q("",!0)]),_:1},8,["data-source","loading","pagination"])])):(p(),b("div",Ge,[a("div",Re,[(p(!0),b(S,null,j(G.value,t=>(p(),b("div",{key:t.id,class:Y(["user-card",{"user-card--drawn":t.has_drawn}])},[a("div",We,[a("div",Xe,c((t.name||"æœª")[0]),1),s(C,{color:t.has_drawn?"success":"default",class:"user-status"},{default:l(()=>[i(c(t.has_drawn?"å·²æŠ½å¥–":"æœªæŠ½å¥–"),1)]),_:2},1032,["color"])]),a("div",Ze,[a("h3",He,c(t.name||"æœªè®¾ç½®å§“å"),1),a("p",Je,"@"+c(t.username),1),a("div",Ke,[s(L,{title:"ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç”¨æˆ·å—ï¼Ÿ",onConfirm:g=>H(t.id)},{default:l(()=>[s(w,{type:"text",danger:"",size:"small"},{default:l(()=>[s(I(J)),e[33]||(e[33]=i(" åˆ é™¤ ",-1))]),_:1})]),_:1},8,["onConfirm"])])])],2))),128))]),G.value.length===0?(p(),z(ue,{key:0,description:"æš‚æ— ç”¨æˆ·æ•°æ®"})):Q("",!0)])),s(X,{open:O.value,"onUpdate:open":e[6]||(e[6]=t=>O.value=t),title:"æ·»åŠ ç”¨æˆ·",maskClosable:!1,onOk:le,onCancel:e[7]||(e[7]=t=>O.value=!1)},{default:l(()=>[s(W,{model:r.value,layout:"vertical"},{default:l(()=>[s(y,{label:"å…¬å¸"},{default:l(()=>[s(U,{value:r.value.company_id,"onUpdate:value":e[3]||(e[3]=t=>r.value.company_id=t),placeholder:"é€‰æ‹©å…¬å¸"},{default:l(()=>[(p(!0),b(S,null,j(D.value,t=>(p(),z(f,{key:t.id,value:t.id},{default:l(()=>[i(c(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),s(y,null,{default:l(()=>[e[34]||(e[34]=a("label",{class:"form-label font-body"},[a("span",{class:"label-icon"},"ğŸ“"),i(" å§“å "),a("span",{style:{color:"red"}},"*")],-1)),s(T,{value:r.value.name,"onUpdate:value":e[4]||(e[4]=t=>r.value.name=t),placeholder:"è¯·è¾“å…¥å§“å",class:"neon-input"},null,8,["value"])]),_:1}),s(y,null,{default:l(()=>[e[35]||(e[35]=a("label",{class:"form-label font-body"},[a("span",{class:"label-icon"},"ğŸ“±"),i(" æ‰‹æœºå·ï¼ˆé€‰å¡«ï¼‰ ")],-1)),s(T,{value:r.value.phone,"onUpdate:value":e[5]||(e[5]=t=>r.value.phone=t),placeholder:"è¯·è¾“å…¥æ‰‹æœºå·",class:"neon-input"},null,8,["value"])]),_:1}),s(R,{message:"æç¤º",description:"æ·»åŠ çš„ç”¨æˆ·ä»…ç”¨äºæŠ½å¥–ï¼Œæ— æ³•ç™»å½•ã€‚ç”¨æˆ·å¯é€šè¿‡æ‰«ç æ³¨å†Œè‡ªå·±è®¾ç½®è´¦å·å¯†ç ã€‚",type:"info","show-icon":"",style:{"margin-bottom":"16px"}})]),_:1},8,["model"])]),_:1},8,["open"]),s(X,{open:V.value,"onUpdate:open":e[12]||(e[12]=t=>V.value=t),title:"ç¼–è¾‘ç”¨æˆ·",maskClosable:!1,onOk:de,onCancel:e[13]||(e[13]=t=>V.value=!1)},{default:l(()=>[s(W,{model:v.value,layout:"vertical"},{default:l(()=>[s(y,null,{default:l(()=>[e[36]||(e[36]=a("label",{class:"form-label font-body"},[a("span",{class:"label-icon"},"ğŸ‘¤"),i(" ç”¨æˆ·å ")],-1)),s(T,{value:v.value.username,"onUpdate:value":e[8]||(e[8]=t=>v.value.username=t),disabled:"",class:"neon-input"},null,8,["value"])]),_:1}),s(y,null,{default:l(()=>[e[37]||(e[37]=a("label",{class:"form-label font-body"},[a("span",{class:"label-icon"},"ğŸ“"),i(" å§“å ")],-1)),s(T,{value:v.value.name,"onUpdate:value":e[9]||(e[9]=t=>v.value.name=t),placeholder:"è¯·è¾“å…¥å§“å",class:"neon-input"},null,8,["value"])]),_:1}),s(y,null,{default:l(()=>[e[38]||(e[38]=a("label",{class:"form-label font-body"},[a("span",{class:"label-icon"},"ğŸ“±"),i(" æ‰‹æœºå·ï¼ˆé€‰å¡«ï¼‰ ")],-1)),s(T,{value:v.value.phone,"onUpdate:value":e[10]||(e[10]=t=>v.value.phone=t),placeholder:"è¯·è¾“å…¥æ‰‹æœºå·",class:"neon-input"},null,8,["value"])]),_:1}),s(y,{label:"æŠ½å¥–çŠ¶æ€"},{default:l(()=>[s(ve,{checked:v.value.has_drawn,"onUpdate:checked":e[11]||(e[11]=t=>v.value.has_drawn=t),"checked-children":"å·²æŠ½å¥–","un-checked-children":"æœªæŠ½å¥–"},null,8,["checked"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"]),s(X,{open:M.value,"onUpdate:open":e[16]||(e[16]=t=>M.value=t),title:"æ‰¹é‡å¯¼å…¥ç”¨æˆ·",onOk:oe,onCancel:e[17]||(e[17]=t=>M.value=!1),width:"700px"},{default:l(()=>[s(R,{message:"âš ï¸ é‡è¦æç¤º",type:"warning","show-icon":"",style:{"margin-bottom":"16px"}},{description:l(()=>[...e[39]||(e[39]=[a("div",{style:{"line-height":"1.8"}},[a("p",{style:{color:"#ff4d4f","font-weight":"600"}},"å¯¼å…¥çš„ç”¨æˆ·ä»…ç”¨äºæŠ½å¥–æ± ï¼Œæ— æ³•ç™»å½•ç³»ç»Ÿï¼"),a("p",{style:{color:"var(--text-secondary)"}},"â€¢ ç”¨æˆ·æ— æ³•ç™»å½•ï¼ˆåªæœ‰ç®¡ç†å‘˜å¯ç™»å½•ï¼‰"),a("p",{style:{color:"var(--text-secondary)"}},"â€¢ ç®¡ç†å‘˜åœ¨æŠ½å¥–é¡µé¢ä»£ä¸ºç”¨æˆ·æ‰§è¡ŒæŠ½å¥–æ“ä½œ"),a("p",{style:{color:"var(--text-secondary)"}},'â€¢ åˆ›å»ºçš„ç”¨æˆ·å°†å‡ºç°åœ¨"æœªæŠ½å¥–ç”¨æˆ·"åˆ—è¡¨ä¸­ä¾›ç®¡ç†å‘˜é€‰æ‹©')],-1)])]),_:1}),s(R,{message:"å¯¼å…¥æ ¼å¼è¯´æ˜",type:"info","show-icon":"",style:{"margin-bottom":"16px"}},{description:l(()=>[...e[40]||(e[40]=[a("div",{style:{"line-height":"1.8"}},[a("p",null,[a("strong",null,"æ¯è¡Œä¸€ä¸ªç”¨æˆ·ï¼Œæ ¼å¼ï¼šå§“å,æ‰‹æœºå·ï¼ˆå¯é€‰ï¼‰")]),a("p",null,[a("strong",null,"æ³¨æ„ï¼š"),i("ä½¿ç”¨è‹±æ–‡é€—å·ï¼ˆ,ï¼‰åˆ†éš”ï¼Œä¸æ˜¯åˆ†å·")]),a("div",{style:{background:"rgba(255,255,255,0.05)",padding:"12px","border-radius":"6px","margin-top":"8px"}},[a("p",{style:{margin:"0",color:"var(--text-secondary)"}},"ç¤ºä¾‹ï¼š"),a("pre",{style:{margin:"8px 0",padding:"12px",background:"rgba(0,0,0,0.3)","border-radius":"4px","font-size":"13px",color:"var(--neon-cyan)"}},`å¼ ä¸‰,13800138000
æå››
ç‹äº”,13900139000`),a("p",{style:{margin:"8px 0 0 0",color:"#999","font-size":"12px"}}," ğŸ’¡ æç¤ºï¼š "),a("ul",{style:{margin:"0","padding-left":"20px",color:"var(--text-secondary)","font-size":"12px"}},[a("li",null,"å§“åå¿…å¡«ï¼Œæ‰‹æœºå·é€‰å¡«"),a("li",null,"æ¯è¡Œä¸€ä¸ªç”¨æˆ·ï¼Œç”¨é€—å·åˆ†éš”"),a("li",null,"å¦‚æœåªæœ‰å§“åï¼Œå¯ä»¥ä¸åŠ é€—å·"),a("li",null,"ç›¸åŒå§“åå’Œæ‰‹æœºå·çš„ç”¨æˆ·ä¼šè¢«è§†ä¸ºé‡å¤")])])],-1)])]),_:1}),s(W,{model:_.value,layout:"vertical"},{default:l(()=>[s(y,{label:"é€‰æ‹©å…¬å¸"},{default:l(()=>[s(U,{value:_.value.company_id,"onUpdate:value":e[14]||(e[14]=t=>_.value.company_id=t),placeholder:"è¯·é€‰æ‹©å…¬å¸",style:{width:"100%"}},{default:l(()=>[(p(!0),b(S,null,j(D.value,t=>(p(),z(f,{key:t.id,value:t.id},{default:l(()=>[i(c(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),s(y,{label:"ç”¨æˆ·åˆ—è¡¨"},{extra:l(()=>[...e[41]||(e[41]=[a("div",{style:{color:"var(--text-tertiary)","font-size":"12px"}}," æ¯è¡Œä¸€ä¸ªç”¨æˆ·ï¼Œæ ¼å¼ï¼šå§“å,æ‰‹æœºå·ï¼ˆæ‰‹æœºå·å¯é€‰ï¼‰ ",-1)])]),default:l(()=>[s(pe,{value:_.value.users,"onUpdate:value":e[15]||(e[15]=t=>_.value.users=t),rows:12,placeholder:`å¼ ä¸‰,13800138000
æå››
ç‹äº”,13900139000`,style:{"font-family":"'Courier New', monospace","font-size":"14px"}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])])}}},da=me(Qe,[["__scopeId","data-v-f6acf1a6"]]);export{da as default};
