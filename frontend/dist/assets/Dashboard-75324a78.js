import{r as I}from"./request-5e349af4.js";import{_ as F}from"./_plugin-vue_export-helper-c27b6911.js";import{j as _,V as i,_ as d,Z as t,a4 as r,a2 as B,a3 as V,a0 as z,a6 as at,o as nt,f as ot,U as h,c,X as u,r as C,G as x,F as R,a1 as T,W as U}from"./vue-vendor-6562d100.js";import{m as Z}from"./antd-vue-e1953b5a.js";import"./axios-78d57de0.js";import"./vendor-a94b8c86.js";import"./antd-icons-bbb5d9cb.js";import"./dayjs-793f537c.js";const rt={class:"stat-icon"},lt={class:"stat-content"},ct={class:"stat-value font-display"},it={class:"stat-label font-body"},dt={class:"trend-icon"},ut={class:"trend-value"},_t={key:0,class:"stat-skeleton"},vt={__name:"StatCard",props:{title:{type:String,required:!0},value:{type:[Number,String],default:0},icon:{type:String,default:"ðŸ“Š"},iconColor:{type:String,default:"#667eea"},trend:{type:String,default:""},trendUp:{type:Boolean,default:!0},showTrend:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},variant:{type:String,default:"default",validator:s=>["default","gradient","glass"].includes(s)}},setup(s){const a=s,l=_(()=>`stat-card--${a.variant}`),g=_(()=>{if(a.iconColor.startsWith("var("))return a.variant==="gradient"?a.iconColor:a.iconColor.replace(")",", 0.1)").replace("var(","var(");const b=a.variant==="gradient"?"1":"0.1";return a.iconColor+b}),m=_(()=>typeof a.value=="number"?a.value.toLocaleString():a.value),k=_(()=>({"stat-trend--up":a.trendUp,"stat-trend--down":!a.trendUp})),p=_(()=>a.trendUp?"â†—":"â†˜");return(b,W)=>(i(),d("div",{class:V(["stat-card",l.value])},[t("div",{class:"stat-icon-wrapper",style:B({background:g.value})},[t("div",rt,r(s.icon),1)],4),t("div",lt,[t("div",ct,r(m.value),1),t("div",it,r(s.title),1),s.showTrend?(i(),d("div",{key:0,class:V(["stat-trend font-body",k.value])},[t("span",dt,r(p.value),1),t("span",ut,r(s.trend),1)],2)):z("",!0)]),s.loading?(i(),d("div",_t)):z("",!0)],2))}},M=F(vt,[["__scopeId","data-v-cf0a768a"]]);const gt=["width","height"],pt=["stroke","stroke-width","r","cx","cy"],ft=["stroke","stroke-width","r","cx","cy"],ht={class:"progress-ring__content"},mt={class:"progress-ring__text font-display"},yt={__name:"ProgressRing",props:{percent:{type:Number,default:0,validator:s=>s>=0&&s<=100},size:{type:Number,default:120},stroke:{type:Number,default:8},strokeColor:{type:String,default:"var(--neon-cyan)"},trackColor:{type:String,default:"var(--bg-secondary)"}},setup(s){const a=s,l=_(()=>a.size/2-a.stroke),g=_(()=>l.value*2*Math.PI),m=_(()=>{const p=a.percent/100;return g.value*(1-p)}),k=_(()=>Math.round(a.percent));return(p,b)=>(i(),d("div",{class:"progress-ring",style:B({width:s.size+"px",height:s.size+"px"})},[(i(),d("svg",{width:s.size,height:s.size,class:"progress-ring__svg"},[t("circle",{stroke:s.trackColor,"stroke-width":s.stroke,fill:"transparent",r:l.value,cx:s.size/2,cy:s.size/2},null,8,pt),t("circle",{stroke:s.strokeColor,"stroke-width":s.stroke,fill:"transparent",r:l.value,cx:s.size/2,cy:s.size/2,class:"progress-ring__circle",style:B({strokeDasharray:g.value+" "+g.value,strokeDashoffset:m.value})},null,12,ft)],8,gt)),t("div",ht,[at(p.$slots,"default",{},()=>[t("span",mt,r(k.value)+"%",1)],!0)])],4))}},kt=F(yt,[["__scopeId","data-v-7bd5a643"]]);const wt={class:"dashboard-container"},bt={class:"dashboard-header"},Ct={class:"dashboard-actions"},xt={class:"stats-grid"},zt={class:"ring-chart-container"},$t={class:"ring-legend"},St={class:"legend-item"},Dt={class:"font-body"},Mt={class:"legend-item"},Bt={class:"font-body"},Nt={class:"prize-levels-list"},Pt={class:"level-info"},It={class:"level-name font-body"},Rt={class:"level-stock"},Tt={class:"level-progress"},Ut={class:"level-meta"},Vt={class:"level-probability"},Ft={class:"ranking-list"},Wt={class:"ranking-rank"},At={key:0,class:"rank-badge rank-gold"},Lt={key:1,class:"rank-badge rank-silver"},qt={key:2,class:"rank-badge rank-bronze"},jt={key:3,class:"rank-number"},Et={class:"ranking-content"},Gt={class:"company-name font-body"},Xt={class:"company-stats"},Zt={class:"stat-item"},Ht={class:"stat-item"},Jt={class:"ranking-rate"},Kt={class:"rate-value"},Ot={class:"winners-list"},Qt={class:"winner-avatar"},Yt={class:"winner-info"},te={class:"winner-name font-body"},ee={class:"winner-prize font-body"},se={class:"winner-company"},ae={class:"winner-time"},ne={class:"winners-footer"},oe={__name:"Dashboard",setup(s){const a=C(!1),l=C({total_users:0,drawn_users:0,total_records:0,levels:[]}),g=C([]),m=C([]),k=C({total_users:0,drawn_users:0});let p=null;const b=_(()=>g.value.length),W=_(()=>l.value.total_users===0?0:Math.round(l.value.drawn_users/l.value.total_users*100)),A=_(()=>g.value.sort((e,n)=>(n.drawn_count||0)-(e.drawn_count||0)).slice(0,5)),H=async()=>{try{const e=await I.get("/admin/stats");k.value={total_users:l.value.total_users,drawn_users:l.value.drawn_users},l.value=e}catch{}},J=async()=>{try{const e=await I.get("/admin/companies");g.value=e.filter(n=>n.is_active)}catch{}},K=async()=>{try{const e=await I.get("/admin/draw-records",{params:{page:1,page_size:5}});m.value=e.data||[]}catch{}},N=async()=>{a.value=!0;try{await Promise.all([H(),J(),K()]),Z.success("æ•°æ®åˆ·æ–°æˆåŠŸ")}catch{Z.error("æ•°æ®åˆ·æ–°å¤±è´¥")}finally{a.value=!1}},L=e=>{const n=l.value[e],w=k.value[e];if(w===0)return"+0%";const v=((n-w)/w*100).toFixed(1);return(v>0?"+":"")+v+"%"},$=e=>e.total_stock===0?0:Math.round(e.used_stock/e.total_stock*100),O=e=>{const n=$(e);return n>=100?"var(--error-color)":n>=80?"var(--warning-color)":"var(--success-color)"},Q=e=>({ä¸€ç­‰å¥–:"var(--neon-magenta)",äºŒç­‰å¥–:"var(--neon-yellow)",ä¸‰ç­‰å¥–:"var(--neon-cyan)",å‚ä¸Žå¥–:"var(--neon-purple)"})[e]||"var(--neon-purple)",Y=e=>e?e.charAt(0):"?",tt=e=>!e.total_users||e.total_users===0?0:((e.drawn_count||0)/e.total_users*100).toFixed(1),et=e=>{const n=new Date(e),v=new Date-n,y=Math.floor(v/6e4),S=Math.floor(v/36e5),D=Math.floor(v/864e5);return y<60?`${y}åˆ†é’Ÿå‰`:S<24?`${S}å°æ—¶å‰`:`${D}å¤©å‰`};return nt(async()=>{await N(),p=setInterval(N,3e4)}),ot(()=>{p&&clearInterval(p)}),(e,n)=>{const w=h("a-button"),v=h("a-card"),y=h("a-col"),S=h("a-progress"),D=h("a-tag"),P=h("a-empty"),q=h("a-row"),st=h("router-link");return i(),d("div",wt,[t("div",bt,[n[2]||(n[2]=t("div",null,[t("h1",{class:"dashboard-title font-display"},"ðŸ“Š æ•°æ®ä»ªè¡¨ç›˜"),t("p",{class:"dashboard-subtitle font-body"},"å®žæ—¶ç›‘æŽ§ç³»ç»Ÿè¿è¥æ•°æ®")],-1)),t("div",Ct,[c(w,{onClick:N,loading:a.value,class:"neon-button"},{icon:u(()=>[...n[0]||(n[0]=[x("ðŸ”„",-1)])]),default:u(()=>[n[1]||(n[1]=x(" åˆ·æ–°æ•°æ® ",-1))]),_:1},8,["loading"])])]),t("div",xt,[c(M,{title:"æ€»ç”¨æˆ·æ•°",value:l.value.total_users,icon:"ðŸ‘¥","icon-color":"var(--neon-purple)",trend:L("total_users"),"show-trend":!0,"trend-up":!0,loading:a.value},null,8,["value","trend","loading"]),c(M,{title:"å·²æŠ½å¥–äººæ•°",value:l.value.drawn_users,icon:"ðŸ†","icon-color":"var(--success-color)",trend:L("drawn_users"),"show-trend":!0,"trend-up":!0,loading:a.value},null,8,["value","trend","loading"]),c(M,{title:"æŠ½å¥–è®°å½•",value:l.value.total_records,icon:"ðŸ“Š","icon-color":"var(--warning-color)","show-trend":!1,loading:a.value},null,8,["value","loading"]),c(M,{title:"å…¬å¸æ•°",value:b.value,icon:"ðŸ¢","icon-color":"var(--info-color)","show-trend":!1,loading:a.value},null,8,["value","loading"])]),c(q,{gutter:[24,24],class:"charts-row"},{default:u(()=>[c(y,{xs:24,sm:12,lg:8},{default:u(()=>[c(v,{title:"ðŸŽ¯ æŠ½å¥–å‚ä¸ŽçŽ‡",class:"chart-card"},{default:u(()=>[t("div",zt,[c(kt,{percent:W.value,size:180,stroke:12,"stroke-color":"var(--neon-purple)"},null,8,["percent"]),t("div",$t,[t("div",St,[n[3]||(n[3]=t("span",{class:"legend-dot font-body",style:{background:"var(--neon-cyan)"}},null,-1)),t("span",Dt,"å·²å‚ä¸Ž: "+r(l.value.drawn_users),1)]),t("div",Mt,[n[4]||(n[4]=t("span",{class:"legend-dot font-body",style:{background:"var(--text-tertiary)"}},null,-1)),t("span",Bt,"æœªå‚ä¸Ž: "+r(l.value.total_users-l.value.drawn_users),1)])])])]),_:1})]),_:1}),c(y,{xs:24,sm:12,lg:16},{default:u(()=>[c(v,{title:"ðŸ† å¥–é¡¹åº“å­˜çŠ¶æ€",class:"chart-card"},{default:u(()=>[t("div",Nt,[(i(!0),d(R,null,T(l.value.levels,o=>(i(),d("div",{key:o.id,class:"level-item"},[t("div",Pt,[t("div",It,[t("span",{class:"level-badge",style:B({background:Q(o.name)})},r(o.name.charAt(0)),5),t("span",null,r(o.name),1)]),t("div",Rt,r(o.used_stock)+" / "+r(o.total_stock),1)]),t("div",Tt,[c(S,{percent:$(o),"stroke-color":O(o),"show-info":!1},null,8,["percent","stroke-color"])]),t("div",Ut,[t("span",Vt,"æ¦‚çŽ‡: "+r((o.probability*100).toFixed(1))+"%",1),c(D,{color:$(o)>=100?"red":"green",size:"small"},{default:u(()=>[x(r($(o)>=100?"å·²æŠ½å®Œ":"åº“å­˜å……è¶³"),1)]),_:2},1032,["color"])])]))),128)),!l.value.levels||l.value.levels.length===0?(i(),U(P,{key:0,description:"æš‚æ— å¥–é¡¹æ•°æ®"})):z("",!0)])]),_:1})]),_:1})]),_:1}),c(q,{gutter:[24,24]},{default:u(()=>[c(y,{xs:24,lg:12},{default:u(()=>[c(v,{title:"ðŸ¢ å…¬å¸æŽ’è¡Œæ¦œ",class:"ranking-card"},{default:u(()=>[t("div",Ft,[(i(!0),d(R,null,T(A.value,(o,f)=>(i(),d("div",{key:o.id,class:V(["ranking-item",{"ranking-top":f<3}])},[t("div",Wt,[f===0?(i(),d("span",At,"ðŸ¥‡")):f===1?(i(),d("span",Lt,"ðŸ¥ˆ")):f===2?(i(),d("span",qt,"ðŸ¥‰")):(i(),d("span",jt,r(f+1),1))]),t("div",Et,[t("div",Gt,r(o.name),1),t("div",Xt,[t("span",Zt,"ðŸ‘¥ "+r(o.total_users||0),1),t("span",Ht,"ðŸ† "+r(o.drawn_count||0),1)])]),t("div",Jt,[t("div",Kt,r(tt(o))+"%",1),n[5]||(n[5]=t("div",{class:"rate-label font-body"},"ä¸­å¥–çŽ‡",-1))])],2))),128)),A.value.length===0?(i(),U(P,{key:0,description:"æš‚æ— å…¬å¸æ•°æ®"})):z("",!0)])]),_:1})]),_:1}),c(y,{xs:24,lg:12},{default:u(()=>[c(v,{title:"ðŸ† æœ€è¿‘ä¸­å¥–",class:"winners-card"},{default:u(()=>[t("div",Ot,[(i(!0),d(R,null,T(m.value,o=>{var f,j,E,G;return i(),d("div",{key:o.id,class:"winner-item"},[t("div",Qt,r(Y((f=o.user)==null?void 0:f.name)),1),t("div",Yt,[t("div",te,r(((j=o.user)==null?void 0:j.name)||"æœªçŸ¥"),1),t("div",ee,r((E=o.level)==null?void 0:E.name),1)]),t("div",se,[c(D,{color:((G=o.company)==null?void 0:G.theme_color)||"blue",size:"small"},{default:u(()=>{var X;return[x(r((X=o.company)==null?void 0:X.name),1)]}),_:2},1032,["color"])]),t("div",ae,r(et(o.created_at)),1)])}),128)),m.value.length===0?(i(),U(P,{key:0,description:"æš‚æ— ä¸­å¥–è®°å½•"})):z("",!0)]),t("div",ne,[c(st,{to:"/admin/dashboard/records",class:"view-all-link"},{default:u(()=>[...n[6]||(n[6]=[x(" æŸ¥çœ‹å…¨éƒ¨ â†’ ",-1)])]),_:1})])]),_:1})]),_:1})]),_:1})])}}},ge=F(oe,[["__scopeId","data-v-a99dabc4"]]);export{ge as default};
