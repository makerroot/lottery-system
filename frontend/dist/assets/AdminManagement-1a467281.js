import{r as b}from"./request-5e349af4.js";import{t as K}from"./form-7cc1eb58.js";import{_ as Q}from"./_plugin-vue_export-helper-c27b6911.js";import{o as R,U as i,V as d,_ as g,Z as u,c as l,X as n,r as v,u as Y,G as c,F as M,W as y,a4 as C,a0 as x,a1 as aa}from"./vue-vendor-6562d100.js";import{m as r}from"./antd-vue-e1953b5a.js";import{P as ea}from"./antd-icons-bbb5d9cb.js";import"./axios-78d57de0.js";import"./vendor-a94b8c86.js";import"./dayjs-793f537c.js";const na={class:"admin-management-page"},ta={class:"page-header"},oa={style:{color:"#9ca3af","font-size":"12px","margin-top":"4px"}},sa={key:0},la={key:1},ia={__name:"AdminManagement",setup(da){const V=v([]),h=v([]),w=v(!1),f=v(null),A=v(null),m=v(!1),o=v({username:"",password:"",admin_type:"admin",company_id:void 0}),B=[{title:"ID",dataIndex:"id",width:60},{title:"ç”¨æˆ·å",dataIndex:"username",width:150},{title:"æ‰€å±žå…¬å¸",key:"company",width:200},{title:"ç±»åž‹",key:"is_super_admin",width:120},{title:"æ“ä½œ",key:"action",width:150}],U=async()=>{try{const a=await b.get("/admin/admins");V.value=a}catch{r.error("èŽ·å–ç®¡ç†å‘˜åˆ—è¡¨å¤±è´¥")}},D=async()=>{try{const a=await b.get("/admin/companies");h.value=a}catch{r.error("èŽ·å–å…¬å¸åˆ—è¡¨å¤±è´¥")}},N=async()=>{try{const a=await b.get("/admin/info");A.value=a.id,m.value=a.is_super_admin}catch{}},$=()=>{f.value=null,o.value={username:"",password:"",admin_type:"admin",company_id:void 0},w.value=!0},F=a=>{a.target.value==="super_admin"&&(o.value.company_id=void 0)},O=a=>{f.value=a,o.value={username:a.username,password:"",admin_type:a.is_super_admin?"super_admin":"admin",company_id:a.company_id},w.value=!0},S=async()=>{var e,p;const a=K(o.value);if(!a.username){r.warning("è¯·è¾“å…¥ç”¨æˆ·å");return}if(!f.value&&!a.password){r.warning("è¯·è¾“å…¥å¯†ç ");return}if(m.value&&a.admin_type==="admin"&&!a.company_id){r.warning("æ™®é€šç®¡ç†å‘˜å¿…é¡»é€‰æ‹©æ‰€å±žå…¬å¸");return}try{if(f.value){const s={username:a.username,is_super_admin:a.admin_type==="super_admin"};a.password&&(s.password=a.password),m.value&&(a.admin_type==="admin"?s.company_id=a.company_id:s.company_id=null),await b.put(`/admin/admins/${f.value.id}`,s),r.success("æ›´æ–°æˆåŠŸ")}else{const s={username:a.username,password:a.password,is_super_admin:a.admin_type==="super_admin"};if(a.admin_type==="admin"){if(!a.company_id){r.warning("æ™®é€šç®¡ç†å‘˜å¿…é¡»é€‰æ‹©æ‰€å±žå…¬å¸");return}s.company_id=a.company_id}await b.post("/admin/admins",s),r.success("æ·»åŠ æˆåŠŸ")}w.value=!1,await U()}catch(s){r.error(((p=(e=s.response)==null?void 0:e.data)==null?void 0:p.error)||"æ“ä½œå¤±è´¥")}},z=()=>{w.value=!1},P=async a=>{var e,p;try{await b.delete(`/admin/admins/${a}`),r.success("åˆ é™¤æˆåŠŸ"),await U()}catch(s){r.error(((p=(e=s.response)==null?void 0:e.data)==null?void 0:p.error)||"åˆ é™¤å¤±è´¥")}};return R(async()=>{await N(),await U(),m.value&&await D()}),(a,e)=>{const p=i("a-button"),s=i("a-tag"),T=i("a-popconfirm"),j=i("a-space"),q=i("a-table"),E=i("a-input"),k=i("a-form-item"),G=i("a-input-password"),I=i("a-radio"),L=i("a-radio-group"),W=i("a-select-option"),X=i("a-select"),Z=i("a-form"),H=i("a-modal");return d(),g("div",na,[u("div",ta,[e[6]||(e[6]=u("h1",{class:"page-title font-display"},"ðŸ” ç®¡ç†å‘˜ç®¡ç†",-1)),l(p,{type:"primary",onClick:$,disabled:!m.value,class:"neon-button"},{default:n(()=>[l(Y(ea)),e[5]||(e[5]=c(" æ·»åŠ ç®¡ç†å‘˜ ",-1))]),_:1},8,["disabled"])]),l(q,{columns:B,"data-source":V.value,pagination:!1,"row-key":"id",class:"admins-table"},{bodyCell:n(({column:t,record:_})=>[t.key==="company"?(d(),g(M,{key:0},[_.company?(d(),y(s,{key:0,color:_.company.theme_color},{default:n(()=>[c(C(_.company.name),1)]),_:2},1032,["color"])):(d(),y(s,{key:1,color:"purple"},{default:n(()=>[...e[7]||(e[7]=[c("è¶…çº§ç®¡ç†å‘˜",-1)])]),_:1}))],64)):t.key==="is_super_admin"?(d(),y(s,{key:1,color:_.is_super_admin?"purple":"blue"},{default:n(()=>[c(C(_.is_super_admin?"è¶…çº§ç®¡ç†å‘˜":"æ™®é€šç®¡ç†å‘˜"),1)]),_:2},1032,["color"])):t.key==="action"?(d(),y(j,{key:2},{default:n(()=>[l(p,{type:"link",onClick:J=>O(_),disabled:!m.value&&_.id!==A.value},{default:n(()=>[...e[8]||(e[8]=[c(" ç¼–è¾‘ ",-1)])]),_:1},8,["onClick","disabled"]),m.value?(d(),y(T,{key:0,title:"ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç®¡ç†å‘˜å—ï¼Ÿ",onConfirm:J=>P(_.id)},{default:n(()=>[l(p,{type:"link",danger:"",disabled:_.id===A.value},{default:n(()=>[...e[9]||(e[9]=[c("åˆ é™¤",-1)])]),_:1},8,["disabled"])]),_:2},1032,["onConfirm"])):x("",!0)]),_:2},1024)):x("",!0)]),_:1},8,["data-source"]),l(H,{open:w.value,"onUpdate:open":e[4]||(e[4]=t=>w.value=t),title:f.value?"ç¼–è¾‘ç®¡ç†å‘˜":"æ·»åŠ ç®¡ç†å‘˜",width:"600px",maskClosable:!1,onOk:S,onCancel:z},{default:n(()=>[l(Z,{model:o.value,layout:"vertical"},{default:n(()=>[l(k,null,{default:n(()=>[e[10]||(e[10]=u("label",{class:"form-label font-body"},[u("span",{class:"label-icon"},"ðŸ‘¤"),c(" ç”¨æˆ·å ")],-1)),l(E,{value:o.value.username,"onUpdate:value":e[0]||(e[0]=t=>o.value.username=t),placeholder:"è¯·è¾“å…¥ç”¨æˆ·å",disabled:f.value!=null,class:"neon-input"},null,8,["value","disabled"])]),_:1}),l(k,null,{default:n(()=>[e[11]||(e[11]=u("label",{class:"form-label font-body"},[u("span",{class:"label-icon"},"ðŸ”‘"),c(" å¯†ç  ")],-1)),l(G,{value:o.value.password,"onUpdate:value":e[1]||(e[1]=t=>o.value.password=t),placeholder:f.value?"ç•™ç©ºåˆ™ä¸ä¿®æ”¹å¯†ç ":"è¯·è¾“å…¥å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰",class:"neon-input"},null,8,["value","placeholder"])]),_:1}),m.value?(d(),y(k,{key:0,label:"ç®¡ç†å‘˜èº«ä»½",name:"admin_type"},{extra:n(()=>[u("div",oa,[o.value.admin_type==="super_admin"?(d(),g("div",sa," ðŸ’¡ è¶…çº§ç®¡ç†å‘˜å¯ä»¥ç®¡ç†æ‰€æœ‰å…¬å¸å’Œæ‰€æœ‰ç®¡ç†å‘˜ ")):(d(),g("div",la," ðŸ’¡ æ™®é€šç®¡ç†å‘˜åªèƒ½ç®¡ç†æ‰€å±žå…¬å¸çš„ç”¨æˆ·å’ŒæŠ½å¥– "))])]),default:n(()=>[l(L,{value:o.value.admin_type,"onUpdate:value":e[2]||(e[2]=t=>o.value.admin_type=t),onChange:F},{default:n(()=>[l(I,{value:"super_admin"},{default:n(()=>[...e[12]||(e[12]=[u("span",{style:{color:"#a855f7"}},"ðŸ‘‘ è¶…çº§ç®¡ç†å‘˜",-1)])]),_:1}),l(I,{value:"admin"},{default:n(()=>[...e[13]||(e[13]=[u("span",{style:{color:"#3b82f6"}},"ðŸ‘¨â€ðŸ’¼ æ™®é€šç®¡ç†å‘˜",-1)])]),_:1})]),_:1},8,["value"])]),_:1})):x("",!0),m.value&&o.value.admin_type==="admin"?(d(),y(k,{key:1,label:"æ‰€å±žå…¬å¸",name:"company_id"},{extra:n(()=>[...e[14]||(e[14]=[u("div",{style:{color:"#f59e0b","font-size":"12px","margin-top":"4px"}}," âš ï¸ æ™®é€šç®¡ç†å‘˜å¿…é¡»é€‰æ‹©æ‰€å±žå…¬å¸ ",-1)])]),default:n(()=>[l(X,{value:o.value.company_id,"onUpdate:value":e[3]||(e[3]=t=>o.value.company_id=t),placeholder:"è¯·é€‰æ‹©æ‰€å±žå…¬å¸",allowClear:"",style:{width:"100%"}},{default:n(()=>[(d(!0),g(M,null,aa(h.value,t=>(d(),y(W,{key:t.id,value:t.id},{default:n(()=>[c(C(t.name)+" ("+C(t.code)+") ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})):x("",!0)]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},wa=Q(ia,[["__scopeId","data-v-2f36830f"]]);export{wa as default};
