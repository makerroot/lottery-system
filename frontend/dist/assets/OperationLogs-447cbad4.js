import{aR as W}from"./vendor-af4d91ab.js";import{r as D}from"./request-57094e38.js";import{j as z,o as X,U as n,V as _,_ as S,u as O,c as a,X as e,F as Y,Z as o,a4 as d,r as x,G as l,W as T,a0 as Z}from"./vue-vendor-6562d100.js";import{_ as h}from"./_plugin-vue_export-helper-c27b6911.js";import{m as F}from"./antd-vue-821a3ecc.js";import"./axios-78d57de0.js";import"./antd-icons-16470984.js";import"./dayjs-793f537c.js";function Q(){const w=localStorage.getItem("admin_user"),I=z(()=>!!w),g=z(()=>{if(!w)return{};try{return JSON.parse(w)}catch{return{}}}),A=z(()=>{var f;return((f=g.value)==null?void 0:f.is_super_admin)||!1}),$=z(()=>A.value);return{isAdmin:I,currentUser:g,isSuperAdmin:A,canManageAllCompanies:$}}const tt={class:"operation-logs-page"},et={key:0,class:"permission-denied"},at={class:"page-header"},st={class:"header-left"},ot={class:"page-description font-body"},lt={class:"stat-info"},nt={class:"stat-value font-display"},rt={class:"stat-info"},dt={class:"stat-value font-display"},it={class:"stat-info"},ut={class:"stat-value font-display"},ct={class:"stat-info"},pt={class:"stat-value font-display"},_t={key:2,class:"details-text"},ft={key:3,class:"font-mono"},mt={__name:"OperationLogs",setup(w){const I=W(),{isAdmin:g,currentUser:A,isSuperAdmin:$}=Q();X(()=>{if(!g.value){F.error("è¯·å…ˆç™»å½•"),I.push("/admin");return}b(),H()});const f=x([]),y=x({}),C=x(!1),i=x({action:"",resource:""}),m=x({current:1,pageSize:20,total:0,showSizeChanger:!0,showTotal:s=>`å…± ${s} æ¡`}),R=[{title:"ID",dataIndex:"id",key:"id",width:80},{title:"æ“ä½œäºº",dataIndex:"admin_name",key:"admin_name",width:120},{title:"æ“ä½œç±»å‹",dataIndex:"action",key:"action",width:100},{title:"èµ„æºç±»å‹",dataIndex:"resource",key:"resource",width:120},{title:"æ“ä½œè¯¦æƒ…",dataIndex:"details",key:"details",ellipsis:!0},{title:"IPåœ°å€",dataIndex:"ip_address",key:"ip_address",width:150},{title:"æ“ä½œæ—¶é—´",dataIndex:"created_at",key:"created_at",width:180}],E=s=>({create:"æ–°å¢",update:"æ›´æ–°",delete:"åˆ é™¤",login:"ç™»å½•",logout:"é€€å‡º"})[s]||s,j=s=>({create:"success",update:"processing",delete:"error",login:"blue",logout:"default"})[s]||"default",q=s=>({admin:"ç®¡ç†å‘˜",company:"å…¬å¸",user:"ç”¨æˆ·",prize_level:"å¥–é¡¹ç­‰çº§",prize:"å¥–å“"})[s]||s,G=s=>{const t=new Date(s),u=t.getFullYear(),L=String(t.getMonth()+1).padStart(2,"0"),M=String(t.getDate()).padStart(2,"0"),c=String(t.getHours()).padStart(2,"0"),v=String(t.getMinutes()).padStart(2,"0"),N=String(t.getSeconds()).padStart(2,"0");return`${u}-${L}-${M} ${c}:${v}:${N}`},b=async()=>{C.value=!0;try{const s={page:m.value.current,page_size:m.value.pageSize};i.value.action&&(s.action=i.value.action),i.value.resource&&(s.resource=i.value.resource);const t=await D.get("/admin/operation-logs",{params:s});f.value=t.data||[],m.value.total=t.total||0}catch{F.error("è·å–æ“ä½œæ—¥å¿—å¤±è´¥")}finally{C.value=!1}},H=async()=>{try{const s=await D.get("/admin/operation-stats"),t={};s.forEach(u=>{t[u.action]=u.count}),y.value=t}catch{}},J=(s,t,u)=>{m.value.current=s.current,m.value.pageSize=s.pageSize,b()};return(s,t)=>{const u=n("a-button"),L=n("router-link"),M=n("a-result"),c=n("a-card"),v=n("a-col"),N=n("a-row"),r=n("a-select-option"),V=n("a-select"),U=n("a-form-item"),K=n("a-form"),B=n("a-tag"),P=n("a-table");return _(),S("div",tt,[O(g)?(_(),S(Y,{key:1},[o("div",at,[o("div",st,[t[3]||(t[3]=o("h1",{class:"page-title font-display"},"ğŸ“‹ æ“ä½œæ—¥å¿—",-1)),o("p",ot,d(O($)?"æŸ¥çœ‹æ‰€æœ‰ç³»ç»Ÿæ“ä½œè®°å½•":"æŸ¥çœ‹æ‚¨æ‰€åœ¨å…¬å¸çš„æ“ä½œè®°å½•"),1)])]),a(N,{gutter:16,class:"stats-row"},{default:e(()=>[a(v,{xs:24,sm:12,md:6},{default:e(()=>[a(c,{class:"stat-card"},{default:e(()=>[t[5]||(t[5]=o("div",{class:"stat-icon",style:{background:"rgba(24, 144, 255, 0.1)",color:"#1890ff"}},"ğŸ“",-1)),o("div",lt,[o("div",nt,d(y.value.create||0),1),t[4]||(t[4]=o("div",{class:"stat-label font-body"},"æ–°å¢æ“ä½œ",-1))])]),_:1})]),_:1}),a(v,{xs:24,sm:12,md:6},{default:e(()=>[a(c,{class:"stat-card"},{default:e(()=>[t[7]||(t[7]=o("div",{class:"stat-icon",style:{background:"rgba(82, 196, 26, 0.1)",color:"#52c41a"}},"âœï¸",-1)),o("div",rt,[o("div",dt,d(y.value.update||0),1),t[6]||(t[6]=o("div",{class:"stat-label font-body"},"æ›´æ–°æ“ä½œ",-1))])]),_:1})]),_:1}),a(v,{xs:24,sm:12,md:6},{default:e(()=>[a(c,{class:"stat-card"},{default:e(()=>[t[9]||(t[9]=o("div",{class:"stat-icon",style:{background:"rgba(255, 77, 79, 0.1)",color:"#ff4d4f"}},"ğŸ—‘ï¸",-1)),o("div",it,[o("div",ut,d(y.value.delete||0),1),t[8]||(t[8]=o("div",{class:"stat-label font-body"},"åˆ é™¤æ“ä½œ",-1))])]),_:1})]),_:1}),a(v,{xs:24,sm:12,md:6},{default:e(()=>[a(c,{class:"stat-card"},{default:e(()=>[t[11]||(t[11]=o("div",{class:"stat-icon",style:{background:"rgba(115, 56, 240, 0.1)",color:"#7338ff"}},"ğŸ”",-1)),o("div",ct,[o("div",pt,d(y.value.login||0),1),t[10]||(t[10]=o("div",{class:"stat-label font-body"},"ç™»å½•è®°å½•",-1))])]),_:1})]),_:1})]),_:1}),a(c,{class:"filter-card"},{default:e(()=>[a(K,{layout:"inline"},{default:e(()=>[a(U,{label:"æ“ä½œç±»å‹"},{default:e(()=>[a(V,{value:i.value.action,"onUpdate:value":t[0]||(t[0]=p=>i.value.action=p),placeholder:"å…¨éƒ¨",style:{width:"150px"},allowClear:"",onChange:b},{default:e(()=>[a(r,{value:""},{default:e(()=>[...t[12]||(t[12]=[l("å…¨éƒ¨",-1)])]),_:1}),a(r,{value:"create"},{default:e(()=>[...t[13]||(t[13]=[l("æ–°å¢",-1)])]),_:1}),a(r,{value:"update"},{default:e(()=>[...t[14]||(t[14]=[l("æ›´æ–°",-1)])]),_:1}),a(r,{value:"delete"},{default:e(()=>[...t[15]||(t[15]=[l("åˆ é™¤",-1)])]),_:1}),a(r,{value:"login"},{default:e(()=>[...t[16]||(t[16]=[l("ç™»å½•",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(U,{label:"èµ„æºç±»å‹"},{default:e(()=>[a(V,{value:i.value.resource,"onUpdate:value":t[1]||(t[1]=p=>i.value.resource=p),placeholder:"å…¨éƒ¨",style:{width:"150px"},allowClear:"",onChange:b},{default:e(()=>[a(r,{value:""},{default:e(()=>[...t[17]||(t[17]=[l("å…¨éƒ¨",-1)])]),_:1}),a(r,{value:"admin"},{default:e(()=>[...t[18]||(t[18]=[l("ç®¡ç†å‘˜",-1)])]),_:1}),a(r,{value:"company"},{default:e(()=>[...t[19]||(t[19]=[l("å…¬å¸",-1)])]),_:1}),a(r,{value:"user"},{default:e(()=>[...t[20]||(t[20]=[l("ç”¨æˆ·",-1)])]),_:1}),a(r,{value:"prize_level"},{default:e(()=>[...t[21]||(t[21]=[l("å¥–é¡¹ç­‰çº§",-1)])]),_:1}),a(r,{value:"prize"},{default:e(()=>[...t[22]||(t[22]=[l("å¥–å“",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(U,null,{default:e(()=>[a(u,{type:"primary",onClick:b,loading:C.value},{default:e(()=>[...t[23]||(t[23]=[l(" åˆ·æ–° ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1}),a(c,{class:"logs-card"},{default:e(()=>[a(P,{columns:R,"data-source":f.value,loading:C.value,pagination:m.value,onChange:J,rowKey:"id"},{bodyCell:e(({column:p,record:k})=>[p.key==="action"?(_(),T(B,{key:0,color:j(k.action)},{default:e(()=>[l(d(E(k.action)),1)]),_:2},1032,["color"])):p.key==="resource"?(_(),T(B,{key:1,color:"blue"},{default:e(()=>[l(d(q(k.resource)),1)]),_:2},1024)):p.key==="details"?(_(),S("div",_t,d(k.details),1)):p.key==="created_at"?(_(),S("span",ft,d(G(k.created_at)),1)):Z("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1})],64)):(_(),S("div",et,[a(M,{status:"403",title:"è¯·å…ˆç™»å½•","sub-title":"æ‚¨éœ€è¦ç™»å½•ç®¡ç†å‘˜è´¦å·æ‰èƒ½è®¿é—®æ­¤é¡µé¢"},{extra:e(()=>[a(L,{to:"/admin"},{default:e(()=>[a(u,{type:"primary",size:"large"},{default:e(()=>[...t[2]||(t[2]=[l("å‰å¾€ç™»å½•",-1)])]),_:1})]),_:1})]),_:1})]))])}}},Ct=h(mt,[["__scopeId","data-v-a9417a38"]]);export{Ct as default};
